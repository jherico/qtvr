{"Shader":{"ver":"0.1","info":{"id":"4tfGRl","date":"1424108109","viewed":879,"name":"Stairway to Heaven Curve","username":"eiffie","description":"One can only guess the hidden meaning of this symbol. (Must be satanic.)","likes":9,"published":3,"flags":0,"tags":["stairwaytoheavencurve"],"hasliked":0},"renderpass":[{"inputs":[{"id":3,"src":"\/presets\/tex02.jpg","ctype":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"outputs":[{"channel":"0"}],"code":"\/\/Stairway to Heaven Curve by eiffie\n\n#define rpm1 1.0\n#define rpm2 -0.666\n#define radius1 0.666\n#define radius2 0.666\n#define len1 2.0\n#define len2 2.0\n\n#define PI 3.14159\n\n#define time iGlobalTime\n#define size iResolution\n#define tex iChannel0\n\nvec3 P1,P2,P3;\nvec2 polarToCart(float a, float r){return r*vec2(cos(a),sin(a));}\nvec2 TT1(float t){return vec2(-1.0,0.0)+polarToCart(t\/10.0*rpm1*2.0*PI,radius1);}\nvec2 TT2(float t){return vec2(1.0,0.0)+polarToCart(t\/10.0*rpm2*2.0*PI,radius2);}\nvec2 jsolve( vec2 a, vec2 b, float l1, float l2 ){\/\/joint solver by iq\n\tvec2 p=b-a,q=p*0.5;\/\/( 0.5 + 0.5*(l1*l1-l2*l2)\/dot(p,p) );\/\/put this back if arms are dif lens\n\treturn a+q+sqrt(max(0.0,l1*l1 - dot(q,q)))*normalize(vec2(-p.y,p.x));\n}\n\nvec2 rotate(vec2 v, float angle) {return cos(angle)*v+sin(angle)*vec2(v.y,-v.x);}\nfloat Tube(vec3 pa, vec3 ba){float h=dot(pa,ba)\/dot(ba,ba);return length(pa-ba*clamp(h,0.0,1.0));}\nint id=0;\nfloat prop;\nfloat DE(in vec3 p0){\n\tvec3 p=p0;\n\tfloat a1=Tube(p-P1,P3-P1);\n\tfloat a2=Tube(p-P2-vec3(0.0,0.05,0.0),P3-P2);\n\tfloat arms=min(a1,a2)-0.03;\n\tfloat pen=max(abs(p.y)-0.2,min(length(p.xz-P1.xz),min(length(p.xz-P2.xz),length(p.xz-P3.xz)))-0.02);\n\tp.x=abs(p.x)-1.0;\n\tfloat r=length(p.xz);\n\tfloat plate=max(r-0.9,abs(p.y)-0.04);\n\tp.y-=0.05;\n\tpen=min(pen,length(p)-0.025);\n\tfloat flr=p0.y+0.05;\n\tif(id<0){\n\t\tif(pen<plate && pen<arms && pen<flr)id=1;\n\t\telse if(plate<arms && plate<flr){id=2;prop=r;}\n\t\telse if(arms<flr)id=3;\n\t\telse id=4;\n\t}\n\treturn min(min(pen,flr),min(plate,arms));\n}\n\nfloat rnd(vec2 c){return fract(sin(dot(vec2(1.317,19.753),c))*413.7972);}\nfloat rndStart(vec2 px){\n\treturn 0.5+0.5*rnd(px+vec2(time*217.0));\n}\nvec3 Sky(vec3 rd){\/\/what sky??\n\treturn vec3(0.7,0.8,1.0)*(0.5+0.5*rd.y);\n}\nvec2 F(float t){\n\tvec2 p1=TT1(t),p2=TT2(t);\n\treturn jsolve(p1,p2,len1,len2);\n}\nvec2 DF(vec2 p, float t){\n\tfloat d1=length(p-F(t)), dt=log(d1+1.0), d2=length(p-F(t+dt));\n\tdt\/=max(d1-d2,0.14*dt);\n\treturn vec2(min(d1,d2),0.75*log(d1*dt+1.0));\n}\n\nvec3 PhonographIt(vec2 p, float et, float px){\n\tfloat t=0.0,d=100.0;\n\tfor(int i=0;i<32;i++){\n\t\tvec2 v=DF(p,t);\n\t\tt+=v.y;\n\t\tif(t>et)break;\n\t\td=min(d,v.x);\n\t}\n\td=smoothstep(0.0,4.0*px,d);\n\tfloat f=max(abs(p.x)-1.75,abs(p.y-1.75)-1.0);\n\treturn mix(vec3(sqrt(d),d*d,d),texture2D(tex,p*0.2).rgb,smoothstep(0.0,px,f));\n}\nfloat shadao(vec3 ro, vec3 rd, float px, vec2 fragCoord){\/\/pretty much IQ's SoftShadow\n\tfloat res=1.0,d,t=2.0*px*rndStart(fragCoord);\n\tfor(int i=0;i<12;i++){\n\t\td=max(px,DE(ro+rd*t)*1.5);\n\t\tt+=d;\n\t\tres=min(res,d\/t+t*0.5);\n\t}\n\treturn res;\n}\n\nvec3 L;\nvec3 Color(vec3 ro, vec3 rd, float t, float px, vec3 col, vec2 fragCoord){\n\tro+=rd*t;\n\tid=-1;float d=DE(ro);\n\tvec2 e=vec2(px*t,0.0);\n\tvec3 dn=vec3(DE(ro-e.xyy),DE(ro-e.yxy),DE(ro-e.yyx));\n\tvec3 dp=vec3(DE(ro+e.xyy),DE(ro+e.yxy),DE(ro+e.yyx));\n\tvec3 N=(dp-dn)\/(length(dp-vec3(d))+length(vec3(d)-dn));\n\tvec3 R=reflect(rd,N);\n\tvec3 lc=vec3(1.0,0.9,0.8),sc,rc=Sky(R);\n\tif(id==1){sc=vec3(0.4);\n\t}else if(id==2){\n\t\tsc=mix(vec3(0.9,0.3,0.2),vec3(0.1),smoothstep(0.29,0.31,prop));\n\t\tif(prop>0.3)N.x+=sin((prop+sin(-2.0+prop))*60.0)*0.5;\n\t}else if(id==3)sc=vec3(0.8,0.7,0.5);\n\telse sc=col;\n\tfloat h=0.2*dot(N,R);\n\tsc*=vec3(0.8+h,1.0,0.8-h);\n\tfloat sh=clamp(shadao(ro,L,px*t,fragCoord)+0.2,0.0,1.0);\n\tsh=sh*(0.5+0.5*dot(N,L)+abs(rd.y)*0.2);\n\tvec3 scol=sh*lc*(sc+rc*pow(max(0.0,dot(R,L)),4.0));\n\tcol=mix(scol,col,clamp(d\/(px*t),0.0,1.0));\n\treturn col;\n}\nmat3 lookat(vec3 fw){\n\tfw=normalize(fw);vec3 rt=normalize(cross(fw,vec3(0.0,1.0,0.0)));return mat3(rt,cross(rt,fw),fw);\n}\nvoid init(float t){\n\tvec2 p1=TT1(t),p2=TT2(t),p3=jsolve(p1,p2,len1,len2);\n\tP1=vec3(p1.x,0.1,p1.y);\n\tP2=vec3(p2.x,0.1,p2.y);\n\tP3=vec3(p3.x,0.1,p3.y);\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tfloat px=1.0\/size.y;\n\tL=normalize(vec3(0.4,0.8,-0.6));\n\tinit(time);\n\tfloat tim=time*0.5;\n\tvec3 ro=vec3(cos(tim*0.3)*3.0,2.5+sin(tim*0.4)*0.25,-2.0);\n\tvec3 rd=lookat(vec3(0.0,0.0,0.666)-ro)*normalize(vec3((2.0*fragCoord.xy-size.xy)\/size.y,3.0));\n\t\/\/ro=eye;rd=normalize(dir);\n\tfloat t=DE(ro)*rndStart(fragCoord),d=0.0,od=10.0;\n\tvec3 col=Sky(rd);\n\tfloat tG=-(0.05+ro.y)\/rd.y,tMAX=10.0;\n\tif(tG>0.0){tMAX=min(tMAX,tG+0.1);col=PhonographIt(ro.xz+rd.xz*tG,time,px*tG);}\n\tvec3 edge=vec3(-1.0);\n\tbool bGrab=false;\n\n\tfor(int i=0;i<64;i++){\n\t\tt+=d;\n\t\td=DE(ro+rd*t);\n\t\tif(d>od){\n\t\t\tif(bGrab && od<px*t && edge.x<0.0){\n\t\t\t\tedge=vec3(edge.yz,t-od);\n\t\t\t\tbGrab=false;\n\t\t\t}\n\t\t}else bGrab=true;\n\t\tod=d;\n\t\tif(t>tMAX || d<0.0001)break;\n\t}\n\tif(d<px*t && t<1000.0){\n\t\tif(edge.x>0.0)edge=edge.yzx;\n\t\tedge=vec3(edge.yz,t);\n\t}\n\tfor(int i=0;i<3;i++){\n\t\tif(edge.z>0.0)col=Color(ro,rd,edge.z,px,col,fragCoord);\n\t\tedge=edge.zxy;\n\t}\n\tfragColor = vec4(1.5*col,1.0);\n}\n","name":"","description":"","type":"image"},{"inputs":[],"outputs":[{"channel":"0"}],"code":"#define bps 2.5\n\/\/ note number to frequency  from https:\/\/www.shadertoy.com\/view\/ldfSW2\nfloat ntof(float n){return (n>0.0)?440.0 * pow(2.0, (n - 67.0) \/ 12.0):0.0;}\nfloat saw(float t){return fract(t)-0.5;}\nfloat ssaw(float t){return abs(fract(t)-0.5)-0.25;}\n\nfloat seq(int b){\n\tfloat n=0.0;\n\tif(b==0||b==14||b==18||b==23||b==25||b==26)n=45.0;\n\tif(b==1||b==6||b==10||b==17||b==22)n=48.0;\n\tif(b==2||b==5||b==9||b==16||b==19||b==21)n=52.0;\n\tif(b==3)n=57.0;\n\tif(b==4||b==7)n=59.0;\n\tif(b==8||b==11)n=60.0;\n\tif(b==12||b==15)n=54.0;\n\tif(b==13)n=50.0;\n\tif(b==24)n=43.0;\n\tif(b==29)n=33.0;\n\tif(b==30)n=41.0;\n\tif(b==31)n=40.0;\n\treturn n;\n}\nvec2 mainSound(float time)\n{\n\tfloat tim=time*bps;\n\tint b=int(mod(floor(tim),32.0));\n\tfloat n=seq(b);\n\tfloat f=ntof(n)*time;\n    float vib=sin(tim*15.0)*0.1;\n\tfloat a1=saw(f+vib)*(1.0-fract(tim));\n\ttim=time*bps*-0.666;\n    vib=sin(tim*15.0)*0.1;\n\tb=int(mod(floor(tim),32.0));\n\tn=seq(b);\n\tf=ntof(n)*-time;\n\tfloat a2=saw(f-vib)*(1.0-fract(tim));\n\treturn vec2(a1,a2*0.5);\n}\n","name":"","description":"","type":"sound"}]}}