{"Shader":{"ver":"0.1","info":{"id":"MtfGWM","date":"1422374802","viewed":898,"name":"Holy Grail Quest II","username":"eiffie","description":"I have been following DarkBeam as he digs up old formulas on fractalforums.com. This one needed work to make it continuous. It has lots of interesting julias.","likes":19,"published":3,"flags":0,"tags":["3dmandelbrot"],"hasliked":0},"renderpass":[{"inputs":[],"outputs":[{"channel":"0"}],"code":"\/\/another holy grail candidate from msltoe found here:\n\/\/http:\/\/www.fractalforums.com\/theory\/choosing-the-squaring-formula-by-location\n\n\/\/I have altered the formula to make it continuous but it still creates the same nice julias - eiffie\n\n#define time iGlobalTime\n#define size iResolution\n\nvec3 C,mcol;\nbool bColoring=false;\n#define pi 3.14159\nfloat DE(in vec3 p){\n\tfloat dr=1.0,r=length(p);\n\t\/\/C=p;\n\tfor(int i=0;i<10;i++){\n\t\tif(r>20.0)break;\n\t\tdr=dr*2.0*r;\n\t\tfloat psi = abs(mod(atan(p.z,p.y)+pi\/8.0,pi\/4.0)-pi\/8.0);\n\t\tp.yz=vec2(cos(psi),sin(psi))*length(p.yz);\n\t\tvec3 p2=p*p;\n\t\tp=vec3(vec2(p2.x-p2.y,2.0*p.x*p.y)*(1.0-p2.z\/(p2.x+p2.y+p2.z)),\n\t\t\t2.0*p.z*sqrt(p2.x+p2.y))+C;\t\n\t\tr=length(p);\n\t\tif(bColoring && i==3)mcol=p;\n\t}\n\treturn min(log(r)*r\/max(dr,1.0),1.0);\n}\n\nfloat rnd(vec2 c){return fract(sin(dot(vec2(1.317,19.753),c))*413.7972);}\nfloat rndStart(vec2 fragCoord){\n\treturn 0.5+0.5*rnd(fragCoord.xy+vec2(time*217.0));\n}\nfloat shadao(vec3 ro, vec3 rd, float px, vec2 fragCoord){\/\/pretty much IQ's SoftShadow\n\tfloat res=1.0,d,t=2.0*px*rndStart(fragCoord);\n\tfor(int i=0;i<4;i++){\n\t\td=max(px,DE(ro+rd*t)*1.5);\n\t\tt+=d;\n\t\tres=min(res,d\/t+t*0.1);\n\t}\n\treturn res;\n}\nvec3 Sky(vec3 rd){\/\/what sky??\n\treturn vec3(0.5+0.5*rd.y);\n}\nvec3 L;\nvec3 Color(vec3 ro, vec3 rd, float t, float px, vec3 col, bool bFill, vec2 fragCoord){\n\tro+=rd*t;\n\tbColoring=true;float d=DE(ro);bColoring=false;\n\tvec2 e=vec2(px*t,0.0);\n\tvec3 dn=vec3(DE(ro-e.xyy),DE(ro-e.yxy),DE(ro-e.yyx));\n\tvec3 dp=vec3(DE(ro+e.xyy),DE(ro+e.yxy),DE(ro+e.yyx));\n\tvec3 N=(dp-dn)\/(length(dp-vec3(d))+length(vec3(d)-dn));\n\tvec3 R=reflect(rd,N);\n\tvec3 lc=vec3(1.0,0.9,0.8),sc=sqrt(abs(sin(mcol))),rc=Sky(R);\n\tfloat sh=clamp(shadao(ro,L,px*t,fragCoord)+0.2,0.0,1.0);\n\tsh=sh*(0.5+0.5*dot(N,L))*exp(-t*0.125);\n\tvec3 scol=sh*lc*(sc+rc*pow(max(0.0,dot(R,L)),4.0));\n\tif(bFill)d*=0.05;\n\tcol=mix(scol,col,clamp(d\/(px*t),0.0,1.0));\n\treturn col;\n}\nmat3 lookat(vec3 fw){\n\tfw=normalize(fw);vec3 rt=normalize(cross(fw,vec3(0.0,1.0,0.0)));return mat3(rt,cross(rt,fw),fw);\n}\n\nvec3 Julia(float t){\n\tt=mod(t,5.0);\n\tif(t<1.0)return vec3(-0.8,0.0,0.0);\n\tif(t<2.0)return vec3(-0.8,0.62,0.41);\n\tif(t<3.0)return vec3(-0.8,1.0,-0.69);\n\tif(t<4.0)return vec3(0.5,-0.84,-0.13);\n\treturn vec3(0.0,1.0,-1.0);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tfloat px=0.5\/size.y;\n\tL=normalize(vec3(0.4,0.8,-0.6));\n\tfloat tim=time*0.5;\n\t\n\tvec3 ro=vec3(cos(tim*1.3),sin(tim*0.4),sin(tim))*3.0;\n\tvec3 rd=lookat(vec3(-0.1)-ro)*normalize(vec3((2.0*fragCoord.xy-size.xy)\/size.y,3.0));\n\t\n\ttim*=0.6;\n\tif(mod(tim,15.0)<5.0)C=mix(Julia(tim-1.0),Julia(tim),smoothstep(0.0,1.0,fract(tim)*5.0));\n\telse C=vec3(-cos(tim),cos(tim)*abs(sin(tim*0.3)),-0.5*abs(-sin(tim)));\n\n\tfloat t=DE(ro)*rndStart(fragCoord),d=0.0,od=10.0;\n\tvec3 edge=vec3(-1.0);\n\tbool bGrab=false;\n\tvec3 col=Sky(rd);\n\tfor(int i=0;i<78;i++){\n\t\tt+=d*0.5;\n\t\td=DE(ro+rd*t);\n\t\tif(d>od){\n\t\t\tif(bGrab && od<px*t && edge.x<0.0){\n\t\t\t\tedge=vec3(edge.yz,t-od);\n\t\t\t\tbGrab=false;\n\t\t\t}\n\t\t}else bGrab=true;\n\t\tod=d;\n\t\tif(t>1000.0 || d<0.00001)break;\n\t}\n\tbool bFill=false;\n\td*=0.05;\n\tif(d<px*t && t<1000.0){\n\t\tif(edge.x>0.0)edge=edge.zxy;\n\t\tedge=vec3(edge.yz,t);\n\t\tbFill=true;\n\t}\n\tfor(int i=0;i<3;i++){\n\t\tif(edge.z>0.0)col=Color(ro,rd,edge.z,px,col,bFill,fragCoord);\n\t\tedge=edge.zxy;\n\t\tbFill=false;\n\t}\n\tfragColor = vec4(2.0*col,1.0);\n}\n","name":"","description":"","type":"image"},{"inputs":[],"outputs":[{"channel":"0"}],"code":"#define bps 6.0\nfloat nofs(float n){\/\/the song's \"random\" ring\n    n=mod(n,8.0);\n    if(n<1.0)return 0.0;\n    if(n<2.0)return 1.0;\n    if(n<3.0)return 2.0;\n    if(n<4.0)return 3.0;\n    if(n<5.0)return -3.0;\n    if(n<6.0)return -2.0;\n    if(n<7.0)return -1.0;\n    return 0.0;\n}\n\nfloat scale(float note){\/\/throws out dissonant tones\n\tfloat n2=mod(note,12.0);\n\t\/\/if((n2==1.0)||(n2==3.0)||(n2==6.0)||(n2==8.0)||(n2==10.0))note=-100.0;\/\/major\n\t\/\/if((n2==1.0)||(n2==4.0)||(n2==6.0)||(n2==9.0)||(n2==11.0))note=-100.0;\/\/minor\n\tif((n2==1.0)||(n2==4.0)||(n2==5.0)||(n2==9.0)||(n2==10.0))note=-100.0;\/\/hungarian minor\n\tif(note>84.0)note=84.0+n2;\n\treturn note;\n}\n#define TAO 6.283185\n\/\/ note number to frequency  from https:\/\/www.shadertoy.com\/view\/ldfSW2\n\/\/float ntof(float n){if(n<12.0)return 0.0;return 440.0 * pow(2.0, (n - 67.0) \/ 12.0);}\n\nfloat ntof(float note){\/\/note frequencies from wikipedia\n\tif(note<12.0)return 0.0;\n\tfloat octave=floor((note+0.5)\/12.0)-5.0;\n\tnote=mod(note,12.0);\n\tfloat nt=493.88;\n    if(note<0.5)nt=261.63;\n\telse if(note<1.5)nt=277.18;\n\telse if(note<2.5)nt=293.66;\n    else if(note<3.5)nt=311.13;\n    else if(note<4.5)nt=329.63;\n    else if(note<5.5)nt=349.23;\n    else if(note<6.5)nt=369.99;\n    else if(note<7.5)nt=392.0;\n    else if(note<8.5)nt=415.30;\n    else if(note<9.5)nt=440.0;\n    else if(note<10.5)nt=466.16;\n\treturn nt*pow(2.0,octave);\n}\n\n\nfloat ssaw(float t){return 4.0*abs(fract(t)-0.5)-1.0;}\nfloat rnd(float t){return fract(sin(t*341.545234)*1531.2341);}\nfloat srnd(float t){float t2=fract(t);return mix(rnd(floor(t)),rnd(floor(t+1.0)),t2*t2*(3.0-2.0*t2));}\nfloat harm(float x,float ps,float hm,float sp){\/\/phase shift, harmonics, spacing\n\tfloat a2=0.0,s=1.0;\n\tfor(int i=0;i<10;i++){\n\t\tif(i<int(hm)){\n\t\t\ta2+=sin((x*s+ps)*TAO)\/s;\n\t\t\ts+=sp;\n\t\t}\n\t}\n\treturn a2*0.5;\n}\nvec2 inst(float n,float t,float bt,float pan,int i){\n\tfloat f=ntof(scale(n)),ps=0.0,hm=0.0,sp=1.0;\n\tif(f<12.0)return vec2(0.0);\t\n\tif(i==0){ps=pow(bt*0.5,0.25)*0.2;hm=9.0;}\n\telse if(i==1){ps=bt*0.5;hm=4.0;sp=0.5;}\n\telse if(i==9){ps=bt*rnd(t);hm=10.0-4.0*bt;f*=0.5+0.5*rnd(t);}\n\tfloat a=harm(f*t,ps,hm,sp);\n\ta*=exp(-bt*(0.9+float(i)))*min(min(bt,2.0-bt)*100.0,1.0)*60.0\/n;\n\treturn vec2(a*(1.0-pan),a*pan);\n}\nvec2 inst2(float nn,float no,float of,float t,float bt,float pan,int i){\n\treturn inst(nn+of,t,bt,pan,i)+inst(no+of,t,bt+1.0,pan,i);\/\/plays new note and tail of last note\n}\nvec2 mainSound(float time)\n{\n\tfloat tim=time*bps;\n\tif(tim>128.0 && tim<256.0)tim=224.0-tim;\n\tfloat b=floor(tim);\n\tfloat t0=fract(tim),t1=mod(tim,2.0)*0.5,t2=mod(tim,4.0)*0.25;\n\tfloat n2=nofs(b*0.0625)+nofs(b*0.125)+nofs(b*0.25);\n\tfloat n1=n2+nofs(b*0.5),n0=n1+nofs(b);\n\tb-=1.0;\/\/go back in time to finish old notes\n\tfloat n5=nofs(b*0.0625)+nofs(b*0.125)+nofs(b*0.25);\n\tfloat n4=n5+nofs(b*0.5),n3=n4+nofs(b);\n\tvec2 a0=inst2(n0,n3,72.0,time,t0,0.8,0);\n\tb-=1.0;\n\tn5=nofs(b*0.0625)+nofs(b*0.125)+nofs(b*0.25);\n\tn4=n5+nofs(b*0.5);\n\tvec2 a1=inst2(n1,n4,60.0,time,t1,0.5,0);\n\tvec2 a1h=inst2(n1,n4,57.0,time,t1,0.6,0);\n\tb-=2.0;\n\tn5=nofs(b*0.0625)+nofs(b*0.125)+nofs(b*0.25);\n\tvec2 a2=inst2(n2,n5,36.0,time,t2,0.2,0);\n\t\/\/vec2 a2h=vec2(0.0);\/\/inst2(n2,n5,53.0,time,t2,0.25,0);\n\t\/\/vec2 a1hb=inst(n1+64.0,time,t1,0.0,1)*2.0;\n\tvec2 v=0.25*(a0+a1+a1h+a2);\n\treturn clamp(v,-1.0,1.0);\n}\n","name":"","description":"","type":"sound"}]}}