{"Shader":{"ver":"0.1","info":{"id":"Msd3zs","date":"1451917999","viewed":257,"name":"Feedback Flames","username":"P_Malin","description":"Playing with the new hotness.","likes":7,"published":3,"flags":32,"tags":["multipass"],"hasliked":0},"renderpass":[{"inputs":[{"id":257,"src":"\/presets\/previz\/buffer00.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"outputs":[{"channel":"0"}],"code":"void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    float fIntensity = texture2D( iChannel0, fragCoord.xy \/ iResolution.xy ).r;    \n    \n\tvec3 vCol = vec3(1.0, 0.4, 0.0) * fIntensity * 4.0;\n    \n\tfragColor = vec4(vCol,1.0);\n}","name":"","description":"","type":"image"},{"inputs":[{"id":257,"src":"\/presets\/previz\/buffer00.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"outputs":[{"channel":"0"}],"code":"float SampleBackbuffer( vec2 vCoord )\n{\n\treturn clamp( texture2D(iChannel0, vCoord \/ iResolution.xy).r, 0.0, 1.0 );\n}\n \n\/\/ Average pixels surrounding vCoord\nfloat GetIntensityAverage( vec2 vCoord )\n{\n\tfloat fDPixel = 1.0;\n\t\n\tfloat fResult \t= SampleBackbuffer( vCoord + vec2(0.0, 0.0) )\n\t\t\t+ SampleBackbuffer( vCoord + vec2( fDPixel, 0.0) )\n\t\t      \t+ SampleBackbuffer( vCoord + vec2(-fDPixel, 0.0) )\n\t\t\t+ SampleBackbuffer( vCoord + vec2(0.0,  fDPixel) )\n\t\t\t+ SampleBackbuffer( vCoord + vec2(0.0, -fDPixel) );\n\t\n\treturn fResult \/ 5.0;       \n}\n \n\nvec2 GetIntensityGradient(vec2 vCoord)\n{\n\tfloat fDPixel = 1.0;\n\t\n\tfloat fPX = SampleBackbuffer(vCoord + vec2( fDPixel, 0.0));\n\tfloat fNX = SampleBackbuffer(vCoord + vec2(-fDPixel, 0.0));\n\tfloat fPY = SampleBackbuffer(vCoord + vec2(0.0,  fDPixel));\n\tfloat fNY = SampleBackbuffer(vCoord + vec2(0.0, -fDPixel));\n\t\n\treturn vec2(fPX - fNX, fPY - fNY);              \n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tvec2 vCoord = fragCoord.xy;\n\t\n\t\/\/ get the intensity at the current pixel\n\tfloat fCurrPixelValue = SampleBackbuffer(vCoord);\n\t\n\tvec2 vFlamePos = vCoord;\n\t\n\t\/\/ move 'down' more the 'hotter' the pixel we sampled was\n\t\/\/ this is the main trick to get flame effect looking interesting\n\tvFlamePos.y -= fCurrPixelValue * 32.0;\n\t\n\t\/\/ always sample at least one pixel below\n\tvFlamePos.y -= 1.0;\n\t\n\t\/\/ move down the intensity gradient\n\t\/\/ (not really necessary for effect but gives the flames some sideways movement + a better shape)\n\tvFlamePos -= GetIntensityGradient(vCoord) * 16.0; \n\t\n\t\/\/ average the surrounding pixels at the new position\n\tfloat fIntensity = GetIntensityAverage(vFlamePos);\n\t\n\t\/\/ fade\n\tfIntensity *= 0.97;\n\t\n\t\/\/ \"random\" junk in the bottom few pixels\n\tif(gl_FragCoord.y < 2.0)\n\t{\n\t\tfIntensity = fract(sin(fract(iGlobalTime + fragCoord.x * 124.1231243) * 32.3242 + sin(iGlobalTime * 23.234234 + fragCoord.x * 1.451243)));\n\t}\n\t\n    fragColor = vec4(fIntensity);\n}\n","name":"","description":"","type":"buffer"}]}}