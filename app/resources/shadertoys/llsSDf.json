{"Shader":{"ver":"0.1","info":{"id":"llsSDf","date":"1440353868","viewed":2766,"name":"Soap bubbles 2D","username":"foxes","description":"It`s bubbles <img src=\"\/img\/emoticonHappy.png\"\/>))","likes":35,"published":3,"flags":8,"tags":["procedural","2d","noise","sound","bubble","cells"],"hasliked":0},"renderpass":[{"inputs":[],"outputs":[{"channel":"0"}],"code":"vec2 uv;\n\nvec2 hash2a(vec2 x,float anim)\n{\n\tfloat r = 523.0*sin(dot(x, vec2(53.3158, 43.6143)));\n    float xa1=fract(anim);\n    float xb1=anim-xa1;\n    anim+=0.5;\n    float xa2=fract(anim);\n    float xb2=anim-xa2;\n    \n    vec2 z1=vec2(fract(15.32354 * (r+xb1)), fract(17.25865 * (r+xb1)));\n    r=r+1.0;\n    vec2 z2=vec2(fract(15.32354 * (r+xb1)), fract(17.25865 * (r+xb1)));\n    r=r+1.0;\n    vec2 z3=vec2(fract(15.32354 * (r+xb2)), fract(17.25865 * (r+xb2)));\n    r=r+1.0;\n    vec2 z4=vec2(fract(15.32354 * (r+xb2)), fract(17.25865 * (r+xb2)));\n\treturn (mix(z1,z2,xa1)+mix(z3,z4,xa2))*0.5;\n}\n\nfloat hashNull(vec2 x)\n{\n    float r = fract(523.0*sin(dot(x, vec2(53.3158, 43.6143))));\n    return r;\n}\n\nvec4 NC0=vec4(0.0,157.0,113.0,270.0);\nvec4 NC1=vec4(1.0,158.0,114.0,271.0);\n\nvec4 hash4( vec4 n ) { return fract(sin(n)*753.5453123); }\nvec2 hash2( vec2 n ) { return fract(sin(n)*753.5453123); }\nfloat noise2( vec2 x )\n{\n    vec2 p = floor(x);\n    vec2 f = fract(x);\n    f = f*f*(3.0-2.0*f);\n\t\n    float n = p.x + p.y*157.0;\n    vec2 s1=mix(hash2(vec2(n)+NC0.xy),hash2(vec2(n)+NC1.xy),vec2(f.x));\n    return mix(s1.x,s1.y,f.y);\n}\n\nfloat noise3( vec3 x )\n{\n    vec3 p = floor(x);\n    vec3 f = fract(x);\n    f = f*f*(3.0-2.0*f);\n\t\n    float n = p.x + dot(p.yz,vec2(157.0,113.0));\n    vec4 s1=mix(hash4(vec4(n)+NC0),hash4(vec4(n)+NC1),vec4(f.x));\n    return mix(mix(s1.x,s1.y,f.y),mix(s1.z,s1.w,f.y),f.z);\n}\n\nvec4 booble(vec2 te,vec2 pos,float numCells)\n{\n    float d=dot(te, te);\n    \/\/if (d>=0.06) return vec4(0.0);\n\n    vec2 te1=te+(pos-vec2(0.5,0.5))*0.4\/numCells;\n    vec2 te2=-te1;\n    float zb1=max(pow(noise2(te2*1000.11*d),10.0),0.01);\n    float zb2=noise2(te1*1000.11*d);\n    float zb3=noise2(te1*200.11*d);\n    float zb4=noise2(te1*200.11*d+vec2(20.0));\n    \n    vec4 colorb=vec4(1.0);\n    colorb.xyz=colorb.xyz*(0.7+noise2(te1*1000.11*d)*0.3);\n    \n    zb2=max(pow(zb2,20.1),0.01);\n    colorb.xyz=colorb.xyz*(zb2*1.9);\n    \n    vec4 color=vec4(noise2(te2*10.8),noise2(te2*9.5+vec2(15.0,15.0)),noise2(te2*11.2+vec2(12.0,12.0)),1.0);\n    color=mix(color,vec4(1.0),noise2(te2*20.5+vec2(200.0,200.0)));\n    color.xyz=color.xyz*(0.7+noise2(te2*1000.11*d)*0.3);\n    color.xyz=color.xyz*(0.2+zb1*1.9);\n    \n    float r1=max(min((0.033-min(0.04,d))*100.0\/sqrt(numCells),1.0),-1.6);\n    float d2=(0.06-min(0.06,d))*10.0;\n    d=(0.04-min(0.04,d))*10.0;\n\tcolor.xyz=color.xyz+colorb.xyz*d*1.5;\n    \n    float f1=min(d*10.0,0.5-d)*2.2;\n    f1=pow(f1,4.0);\n    float f2=min(min(d*4.1,0.9-d)*2.0*r1,1.0);\n\n    float f3=min(d2*2.0,0.7-d2)*2.2;\n    f3=pow(f3,4.0);\n    \n\treturn vec4(color*max(min(f1+f2,1.0),-0.5)+vec4(zb3)*f3-vec4(zb4)*(f2*0.5+f1)*0.5);\n}\n\n\/\/ base from https:\/\/www.shadertoy.com\/view\/4djGRh\nvec4 Cells(vec2 p,vec2 move, in float numCells,in float count,float blur)\n{\n    vec2 inp=p+move;\n\tinp *= numCells;\n\tfloat d = 1.0;\n    vec2 te;\n    vec2 pos;\n\tfor (int xo = -1; xo <= 1; xo++)\n\t{\n\t\tfor (int yo = -1; yo <= 1; yo++)\n\t\t{\n\t\t\tvec2 tp = floor(inp) + vec2(xo, yo);\n            vec2 rr=mod(tp, numCells);\n            tp=tp + (hash2a(rr,iGlobalTime*0.1)+hash2a(rr,iGlobalTime*0.1+0.25))*0.5;\n\t\t\tvec2 l = inp - tp;\n            float dr=dot(l, l);\n            if (hashNull(rr)>count)\n                if (d>dr) {\n\t\t\t\t\td = dr;\n                    pos=tp;\n                }\n\t\t}\n\t}\n    if (d>=0.06) return vec4(0.0);\n    te=inp-pos;\n    \n    \/\/te=te+(te*noise3(vec3(te*5.9,iGlobalTime*40.0))*0.02);\n    \/\/te=te+(te*(noise3(vec3(te*3.9+p,iGlobalTime*0.2))+noise3(vec3(te*3.9+p,iGlobalTime*0.2+0.25))+noise3(vec3(te*3.9+p,iGlobalTime*0.2+0.5))+noise3(vec3(te*3.9+p,iGlobalTime*0.2+0.75)))*0.05);\n     \n    if (d<0.04) uv=uv+te*(d)*2.0;\n    if (blur>0.0001) {\n        vec4 c=vec4(0.0);\n        for (float x=-1.0;x<1.0;x+=0.5) {\n            for (float y=-1.0;y<1.0;y+=0.5) {\n                c+=booble(te+vec2(x,y)*blur,p,numCells);\n            }\n        }\n        return c*0.05;\n    }\n\n    return booble(te,p,numCells);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tuv = (fragCoord.xy) \/ iResolution.y*0.5;\n    \n    vec2 l1=vec2(iGlobalTime*0.02,iGlobalTime*0.02);\n    vec2 l2=vec2(-iGlobalTime*0.01,iGlobalTime*0.007);\n    vec2 l3=vec2(0.0,iGlobalTime*0.01);\n    \n    \/\/vec4 e=vec4(noise2(uv*2.0),noise2(uv*2.0+vec2(200.0)),noise2(uv*2.0+vec2(50.0)),0.0);\n    vec4 e=vec4(noise3(vec3(uv*2.0,iGlobalTime*0.1)),noise3(vec3(uv*2.0+vec2(200.0),iGlobalTime*0.1)),noise3(vec3(uv*2.0+vec2(50.0),iGlobalTime*0.1)),0.0);\n    \n\tvec4 cr1=Cells(uv,vec2(20.2449,93.78)+l1,2.0,0.5,0.005);\n    vec4 cr2=Cells(uv,vec2(0.0,0.0),3.0,0.5,0.003);\n    vec4 cr3=Cells(uv,vec2(230.79,193.2)+l2,4.0,0.5,0.0);\n    vec4 cr4=Cells(uv,vec2(200.19,393.2)+l3,7.0,0.8,0.01);\n    vec4 cr5=Cells(uv,vec2(10.3245,233.645)+l3,9.2,0.9,0.02);\n    vec4 cr6=Cells(uv,vec2(10.3245,233.645)+l3,14.2,0.95,0.05);\n    \n    e=max(e-vec4(dot(cr6,cr6))*0.1,0.0)+cr6*1.6;\n    e=max(e-vec4(dot(cr5,cr5))*0.1,0.0)+cr5*1.6;\n    e=max(e-vec4(dot(cr4,cr4))*0.1,0.0)+cr4*1.3;\n    e=max(e-vec4(dot(cr3,cr3))*0.1,0.0)+cr3*1.1;\n    e=max(e-vec4(dot(cr2,cr2))*0.1,0.0)+cr2*1.4;\n    \n\te=max(e-vec4(dot(cr1,cr1))*0.1,0.0)+cr1*1.8;\n    \n    \/\/e=e*(3.0+sin(iGlobalTime*10.0)*0.4+sin(iGlobalTime*5.0)*0.5+sin(iGlobalTime*100.0)*0.05 )*0.25;\n    \n\tfragColor= e;\n}\n","name":"","description":"","type":"image"},{"inputs":[],"outputs":[{"channel":"0"}],"code":"\/\/ Panteleymonov A. K. 2015\n\n#define pi 3.1415926535897932384626433832795\n\n\/\/ base piano\nvec2 Instr1(float de,float time)\n{\n\tfloat f0=440.0*de*0.001953125;\n  \tfloat f1=440.0*de*0.001953125;\n  \tfloat f2=440.0*de*0.001953125;\n  \tfloat a=sin(2.0*f0*pi*time);\n    float b=sin(4.0*f0*pi*time)*0.08;\n    float c=sin(8.0*f0*pi*time)*0.04;\n    float d=sin(16.0*f0*pi*time)*0.002;\n    float e=sin(32.0*f0*pi*time)*0.001;\n    float f=sin(f0*pi*time)*0.02;\n  \treturn vec2((a+b+c+e+f)*0.5*exp(-1.0*time));\n}\n\n\/\/ bass\nvec2 Instr2(float de,float time)\n{\n\tfloat x=pi*time*2.0;\n\tfloat f0=de*110.0*0.015625;\n    float f1=0.2;\n  \tfloat f2=0.25;\n  \tfloat a=sin(2.0*f0*pi*time);\n  \tfloat c=f1*time+f2*a;\n  \tfloat b=sin(a*c*2.0*pi);\n  \treturn vec2((b)*0.9*exp(-0.3*time)*exp(-0.3*time)*exp(-0.1*time));\n}\n\n\/\/ light piano\nvec2 Instr3(float de,float time)\n{\n\tfloat f0=440.0*de*0.001953125;\n  \tfloat f1=440.0*de*0.001953125;\n  \tfloat f2=440.0*de*0.001953125;\n  \tfloat a=sin(2.0*f0*pi*time);\n    float b=sin(4.0*f0*pi*time)*0.08;\n    float c=sin(8.0*f0*pi*time)*0.04;\n    float d=sin(16.0*f0*pi*time)*0.002;\n    float e=sin(32.0*f0*pi*time)*0.001;\n    float f=sin(f0*pi*time)*0.02;\n  \treturn vec2((a+b+c+e+f)*0.5*exp(-0.6*time)*exp(-1.0*time));\n}\n\n#define DO 261.63\n#define DO_ 277,183\n#define RE 293.66\n#define RE_ 311,127\n#define MI 329.63\n#define FA 349.2\n#define FA_ 369.994\n#define SOL 392.00\n#define SOL_ 415.30\n#define LYA 440.00\n#define LYA_ 466.164\n#define SI 493.88\n\n#define PI1(a,b) if (f>=a && f<a+7) r+=Instr1(b,fract(ms)+float(f-a))*v;\n#define PI2(a,b,v) if (f>=a && f<a+20) r+=Instr2(b,fract(ms)+float(f-a))*v;\n#define PI3(a,b) if (f>=a && f<a+20) r+=Instr3(b,fract(ms)+float(f-a))*v;\n\nvec2 PathPiano1(float time)\n{\n    float ms=time;\n    int f=int(floor(ms));\n    int fd=int(floor(ms*0.015625));\n    \n    f=int(mod(float(f),64.0));\n    fd=int(mod(float(fd),64.0));\n    \n    vec2 r=vec2(0.0);\n    if (fd==2) {\n        float v=0.7;\n        PI3(0,DO*1.0)PI3(0,SOL*0.5)PI3(0,MI*0.5)\n\t\tPI3(3,MI*1.0)PI3(6,SOL*1.0)PI3(9,DO*1.0)\n\t\tPI3(16,DO*1.0)PI3(16,LYA*0.5)PI3(16,MI*0.5)\n\t\tPI3(19,SI*1.0)PI3(22,LYA*1.0)\n\t\tPI3(32,DO*1.0)PI3(32,SOL*0.5)PI3(32,MI*0.5)\n\t\tPI3(36,DO*2.0)PI3(46,SOL*1.0)PI3(47,LYA*1.0)\n        PI3(48,MI*1.0)PI3(48,SI*0.5)PI3(48,SOL*0.5)\n        PI3(56,RE*1.0)\n\t\tPI2(0,DO*0.25,0.2)PI2(16,LYA*0.125,0.15)PI2(32,MI*0.25,0.2)PI2(48,SI*0.125,0.2)\n    }\n    \n    return r;\n}\n\nvec2 PathPiano2(float time)\n{\n    float ms=time;\n    int f=int(floor(ms));\n    int fd=int(floor(ms*0.015625));\n    \n    f=int(mod(float(f),64.0));\n    fd=int(mod(float(fd),64.0));\n    \n    vec2 r=vec2(0.0);\n    if (fd==0 || fd==1) {\n        float v=1.0;\n        PI1(0,DO*0.25)PI1(1,SOL*0.125)PI1(2,MI*0.125)\n        PI1(3,MI*0.25)PI1(4,DO*0.25)PI1(5,SOL*0.125)\n        PI1(6,SOL*0.25)PI1(7,RE*0.25)PI1(8,SI*0.125)\n\n        PI1(16,DO*0.25)PI1(17,LYA*0.125)PI1(18,MI*0.125)\n        PI1(19,RE*0.25)PI1(20,SI*0.125)PI1(21,SOL*0.125)\n        PI1(22,DO*0.25)PI1(23,LYA*0.125)PI1(24,MI*0.25)\n\n        PI1(32,DO*0.25)PI1(33,SOL*0.125)PI1(34,MI*0.125)\n        PI1(35,MI*0.25)PI1(36,SI*0.125)PI1(37,SOL*0.125)\n        PI1(38,FA*0.25)PI1(39,DO*0.25)PI1(40,LYA*0.125)\n\n        PI1(48,MI*0.25)PI1(49,SI*0.125)PI1(50,SOL*0.125)\n        PI1(51,DO*0.25)PI1(52,LYA*0.125)PI1(53,MI*0.125)\n        PI1(54,SI*0.125)PI1(55,SOL*0.125)PI1(56,LYA*0.125)\n\t}\n    \n    return r;\n}\n\nvec2 mainSound(float time)\n{\n    vec2 r=vec2(0.0);\n    \n    float ms=time*4.0;\n    int f=int(floor(ms));\n    int fd=int(floor(ms*0.015625));\n    \n    \/\/PI1(0,261.63)PI1(1,277.18)PI1(2,293.66)PI1(3,311.13)PI1(4,329.63)PI1(5,349.23)PI1(6,369.99)\n\t\/\/PI1(0,DO)PI1(1,RE)PI1(2,MI)PI1(3,349.23)PI1(4,SOL)PI1(5,440.00)PI1(6,493.88)PI1(7,DO*2.0)\n    \/\/PI1(0,SOL)PI1(3,LYA)PI1(4,DO)PI1(6,MI)PI1(9,DO)PI1(10,SI*0.5)PI1(12,MI*0.5)\n    \n    f=int(mod(float(f),64.0));\n    fd=int(mod(float(fd),64.0));\n    \/\/PI1(0,LYA)PI1(1,SOL)PI1(2,DO*2.0)PI1(3,LYA)PI1(4,FA)PI1(5,SOL)PI1(6,DO)PI1(7,SOL)\n    \n    \/*PI1(0,LYA*0.25)PI1(1,LYA*0.25)PI1(4,LYA*0.25)PI1(7,LYA*0.25)\n\tPI1(8,LYA*0.25)PI1(9,LYA*0.25)PI1(12,LYA*0.25)PI1(15,LYA*0.25)\n    PI1(16,DO*0.5)PI1(17,DO*0.5)PI1(20,DO*0.5)PI1(23,DO*0.5)\n    PI1(24,FA*0.25)PI1(25,FA*0.25)PI1(28,FA*0.25)PI1(31,SOL*0.25)*\/\n    \n    \/*PI1(0,FA*0.125)PI1(1,LYA*0.125)PI1(2,DO*0.25)PI1(3,MI*0.25)PI1(4,FA*0.25)\n\tPI1(8,RE*0.125)PI1(9,SOL*0.125)PI1(10,SI*0.125)PI1(11,DO*0.25)PI1(12,RE*0.25)*\/\n    \n    r+=PathPiano1(time*4.0)+PathPiano1(time*4.0-1.5)*vec2(0.01,0.2)+PathPiano1(time*4.0-3.0)*vec2(0.15,0.01)+PathPiano1(time*4.0-4.5)*vec2(0.01,0.01);\n    \n    if (fd==1) {\n    \tPI2(0,DO*0.0625,1.2)PI2(8,SI*0.03125,0.3)PI2(16,LYA*0.03125,1.2)PI2(24,MI*0.03125,0.8)\n\t\tPI2(32,MI*0.0625,1.0)PI2(40,DO*0.0625,0.3)PI2(48,SI*0.03125,1.2)PI2(56,LYA*0.03125,0.3)\n\t}\n\n    r+=PathPiano2(time*4.0)+PathPiano2(time*4.0-1.5)*vec2(0.01,0.1)+PathPiano2(time*4.0-3.0)*vec2(0.05,0.01)+PathPiano2(time*4.0-4.5)*vec2(0.01,0.01);\n\n    return r;\n}","name":"","description":"","type":"sound"}]}}