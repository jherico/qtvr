{"Shader":{"ver":"0.1","info":{"id":"4sXGDH","date":"1368333236","viewed":2374,"name":"Lemminvade","username":"movAX13h","description":"Sprite animation: 6x10, 4 colors, 8 frames; 1 frame is defined by 5 numbers; One number contains 12px (24bit); 2 bit per pixel. Click+drag mouse to change landing zone and direction.","likes":27,"published":3,"flags":0,"tags":["2d","mouse","music","animation","sprite","beatsync"],"hasliked":0},"renderpass":[{"inputs":[{"id":10,"src":"\/presets\/tex09.jpg","ctype":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"id":19,"src":"\/presets\/mzk02.mp3","ctype":"music","channel":1,"sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}}],"outputs":[{"channel":"0"}],"code":"\/\/ created by movAX13h, filip.sound@gmail.com, May 2013\n\n#define I_HAVE_NO_WEB_AUDIO 0\n\nstruct Frame\n{\n\tfloat s[5]; \/\/ slices\n};\n\n\/\/ constant-array-index workaround ---\nFrame frame(Frame frames[8], int id) \n{\n\tif (id == 0) return frames[0];\n\tif (id == 1) return frames[1];\n\tif (id == 2) return frames[2];\n\tif (id == 3) return frames[3];\n\tif (id == 4) return frames[4];\n\tif (id == 5) return frames[5];\n\tif (id == 6) return frames[6];\n\treturn frames[7];\n}\n\t\nfloat slice(Frame frame, int id)\n{\n\tif (id == 0) return frame.s[0];\n\tif (id == 1) return frame.s[1];\n\tif (id == 2) return frame.s[2];\n\tif (id == 3) return frame.s[3];\n\treturn frame.s[4];\n}\n\nvec3 color(vec3 colors[4], int id)\n{\n\tif (id == 0) return colors[0];\n\tif (id == 1) return colors[1];\n\tif (id == 2) return colors[2];\n\treturn colors[3];\n}\n\/\/ ---\n\nint sprite(Frame frame, vec2 p)\n{\n\tint d = 0;\n\tp = floor(p);\n\tif (clamp(p.x,0.0,5.0) == p.x && clamp(p.y,0.0,9.0) == p.y)\n\t{\n        int s = int(p.y \/ 2.0);\n        float o = float(s)*12.0;\n        float k = ((p.x + p.y*6.0) - o)*2.0;\n        float n = slice(frame, s);\n        if (int(mod(n\/(pow(2.0,k)),2.0)) == 1) d += 2;\n        if (int(mod(n\/(pow(2.0,k+1.0)),2.0)) == 1) d++;\n\t}\n\treturn d;\n}\n\nfloat invader(vec2 p, float n, float d)\n{\n\tp.x = abs(p.x);\n\tp.y = -floor(p.y - 5.0);\n\tif (p.x <= 2.0) \n\t{\n\t\tif (int(mod(n\/(pow(2.0,floor(p.x + p.y*3.0))),2.0)) == 1) return 1.0;\n\t}\n\treturn d;\n}\n\nfloat hash(float n)\n{\n    return fract(sin(n)*43758.5453);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\t\/\/ frames\n\tFrame frames[8];\n\tframes[0].s[0]=2228224.0; frames[0].s[1]= 721568.0; frames[0].s[2]=3997948.0; frames[0].s[3]=16073552.0; frames[0].s[4]=15790420.0;\n\tframes[1].s[0]= 655360.0; frames[1].s[1]=3130040.0; frames[1].s[2]= 852176.0; frames[1].s[3]=  328528.0; frames[1].s[4]=12832084.0;\n\tframes[2].s[0]=2785280.0; frames[2].s[1]=1032880.0; frames[2].s[2]= 852176.0; frames[2].s[3]=  327888.0; frames[2].s[4]=  983888.0;\n\tframes[3].s[0]=2752648.0; frames[3].s[1]=1032880.0; frames[3].s[2]= 458960.0; frames[3].s[3]=  340083.0; frames[3].s[4]= 3932492.0;\n\tframes[4].s[0]=2228224.0; frames[4].s[1]= 721568.0; frames[4].s[2]= 459004.0; frames[4].s[3]=  376944.0; frames[4].s[4]=15790420.0;\n\tframes[5].s[0]= 655360.0; frames[5].s[1]=3130040.0; frames[5].s[2]= 852176.0; frames[5].s[3]=  327792.0; frames[5].s[4]=12832084.0;\n\tframes[6].s[0]=2785280.0; frames[6].s[1]=3130032.0; frames[6].s[2]= 458960.0; frames[6].s[3]=  327888.0; frames[6].s[4]=  983888.0;\n\tframes[7].s[0]=2752648.0; frames[7].s[1]=1032880.0; frames[7].s[2]=3473616.0; frames[7].s[3]=  340819.0; frames[7].s[4]= 3932492.0;\n\t\n\t\/\/ time & space\n  #if I_HAVE_NO_WEB_AUDIO\n\tfloat time = iGlobalTime*1.89;\n  #else\n\tfloat time = iChannelTime[1]*1.89-0.08;\n  #endif\n\t\n\tfloat mouse = iMouse.x;\n\tif (mouse < 10.0 || mouse > iResolution.x-10.0) mouse = iResolution.x*0.68;\n\t\n\tvec2 p = fragCoord.xy * 0.25;\n\tp.y = - p.y;\n\n\tvec3 col = vec3(0.0, 0.0, 0.1);\n\tvec3 colors[4];\n\t\n\t\/\/ ground\n\tcolors[0] = vec3(0.38, 0.0, 0.06); colors[1] = vec3(0.57, 0.14, 0.07); colors[2] = vec3(0.79, 0.33, 0.08); colors[3] = vec3(0.9, 0.51, 0.13);\n\t\n\tfloat f = floor(-iResolution.y*0.125 + 11.0);\n\tint i = int(4.0*texture2D(iChannel0, floor(p)*0.005 + vec2(0.2,0.5)).r);\n\tcol = mix(col, color(colors, i), step(f, p.y));\n\n\t\/\/ swirl\n\tfloat h = smoothstep(2.0, 60.0, abs(fragCoord.x-mouse));\n\tvec2 q = p;\n\tq.x += floor((1.0-h)*(5.0*sin(0.1*p.y + time) + 3.0*sin(0.07*p.y + time + 2.0)));\n\t\n    \/\/ background\n\ti = int(4.0*texture2D(iChannel0, floor(q)*0.003).r);\n\th = 1.2*smoothstep(f, f*4.0, q.y+sin(time + q.x*0.3)*5.0);\n\tcol = mix(col, color(colors, i), h);\n\t\n\t\/\/ grass\n\tcolors[0] = vec3(0.44, 0.57, 0.0); colors[1] = vec3(0.13, 0.39, 0.13);\n\t\n\tvec2 g = floor(p);\n\tfloat d = f - g.y;\n\th = floor(hash(g.x)*2.3);\n\tg.y += h;\n\ti = int(abs(sin(-h*0.2+d*0.6+0.3))*2.0);\n\tcol = mix(col, color(colors, i), 1.0 - step(3.0, abs(g.y-f-2.0)));\n\n\t\/\/ lemmings\n\tcolors[0] = vec3(0.0); colors[1] = vec3(0.0, 0.73, 0.0); colors[2] = vec3(0.26, 0.26, 0.92); colors[3] = vec3(1.0, 1.0, 1.0);\n\tp.y += 9.0-f;\n\tif (iMouse.z > 0.0) p.x *= 1.0 - 2.0 * step(fragCoord.x, mouse);\n\telse p.x *= 1.0 - 2.0 * step(mouse, fragCoord.x);\n\tp.x = mod(p.x + floor(time*4.0), 12.0);\n\t\n\tf = length(fragCoord.xy-vec2(mouse, max(iResolution.y *0.5 - 30.0, fragCoord.y)));\n\tp.y += floor(60.0*(smoothstep(40.0, 0.0, floor(f)))); \/\/ elevation\n\ti = sprite(frame(frames, int(mod(floor(time*4.0+1.0), 8.0))), p);\n\th = smoothstep(10.0, 120.0, abs(fragCoord.x-mouse));\n\tcol = mix(col, color(colors, i), h*min(1.0, float(i)));\n\n\t\/\/ beam\n\tfloat r = 10.0*sin(p.y*0.1 + time*2.0);\n\th = smoothstep(180.0, 10.0, f-r);\n\tcol += h*0.6;\n\n\t#if 0\n\th *= smoothstep(120.0, 10.0, r); col *= h;\n\t#endif\n\n\t\/\/ invaders\n\tp = 0.25*(fragCoord.xy - vec2(mouse, iResolution.y));\n\tp.x += sin(p.y*0.15 - time*3.0)*2.0;\n\tp.y += time*(1.0 - 2.0 * step(0.1, iMouse.z))*15.0;\n\n\tq.x = p.x;\n\tq.y = mod(p.y, 20.0);\n\t\n\tfloat t = floor(time * 0.5);\n\th = mod(hash(floor(p.y\/20.0)),33554430.0);\n\tf = invader(floor(q), h, 0.0) * smoothstep(iResolution.y*0.6, iResolution.y, fragCoord.y);\n\tcol = mix(col, vec3(1.0), f);\n\t\n\tfragColor = vec4(col, 1.0);\n}","name":"","description":"","type":"image"}]}}