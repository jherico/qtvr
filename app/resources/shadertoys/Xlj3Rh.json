{"Shader":{"ver":"0.1","info":{"id":"Xlj3Rh","date":"1426859378","viewed":864,"name":"[NV15] DIY Spaceman Cave","username":"eiffie","description":"You can tell your under pressure when you turn to glow.","likes":17,"published":3,"flags":0,"tags":["nv15","spacejunk"],"hasliked":0},"renderpass":[{"inputs":[],"outputs":[{"channel":"0"}],"code":"\/\/ DIY Spaceman Cave by eiffie\n\/\/ Stole a bit from kali on this one.\n#define PI 3.1416\n#define SUN vec3(0.73,0.1,0.689)\n\nfloat tym,ftym,ud1,ud2,ud3=0.0;\nint iStop;\nvoid Setup(float t){\n\ttym=t*0.2;\n\tiStop=int(floor(tym));\n\tif(tym<3.4){\n\t\tfloat ft=fract(tym);\n\t\tftym=clamp(ft*5.0,0.0,1.0);\n\t\tif(ft<0.2){ud1=0.66;ud2=ftym*0.33;}\n\t\telse if(ft<0.4){ft=(ft-0.2)*5.0;ud1=mix(0.66,1.0,ft);ud2=mix(0.33,0.0,ft);}\n\t\telse if(ft<0.6){ft=(ft-0.4)*5.0;ud1=1.0;ud2=ft;}\n\t\telse if(ft<0.8){ft=(ft-0.6)*5.0;ud1=1.0-ft;ud2=1.0-ft;}\n\t\telse {ft=(ft-0.8)*5.0;ud1=mix(0.0,0.66,ft);ud2=0.0;}\n\t}else{\n\t\tif(tym<12.0 || mod(tym,6.0)>3.0){\n\t\t\tud1=1.0;\n\t\t\tud2=0.0;\n\t\t\tftym=min(1.0+tym-3.4,2.0);\n\t\t\tud3=clamp(tym*0.2-1.0,0.0,0.4);\n\t\t}else{ud1=1.0;ud2=1.0;ftym=2.0;}\n\t}\n}\n\nvec2 rotate(vec2 v, float angle) {return cos(angle)*v+sin(angle)*vec2(v.y,-v.x);}\n\nfloat Oct(in vec3 p, float r1){p=abs(p);return 0.577*(p.x+p.y+p.z-r1);}\nvec2 TubeFrame(in vec3 p){\n\tp=abs(p);\n\tp.x-=1.0;\n\tvec3 b=vec3(-1.0,ud1,ud2);\n\tfloat t=clamp(dot(p,b)\/dot(b,b),0.0,1.0);\n\treturn vec2(length(p-b*t)-0.03+clamp((abs(fract(t*4.0)-0.5)-0.25)*0.1,0.0,0.01),t);\n}\nvoid Srp(inout vec4 p, inout int iCnt){\n\tp = abs(p)*2.0;\n\tif (p.x<p.y){p.xy = p.yx;iCnt++;}\n\tif (p.x<p.z)p.xz = p.zx;\n\tif (p.y<p.z)p.yz = p.zy;\n\tp.x-=1.0;\n}\n\nfloat DE(in vec3 p0){\n\tvec4 p=vec4(p0,1.0);\n\tint iCnt=0;\n\tfor (int n = 0; n < 3; n++) {\n\t\tif(n==iStop)break;\n\t\tif(n==2 && ud3>0.0)p.yz=rotate(p.yz,ud3);\n\t\tSrp(p,iCnt);\n\t}\n\tvec4 pL=p;\n\tfloat d=100.0;\n\tif(ftym>1.0 && iCnt>1){\n\t\tpL.x+=ftym-2.0;\n\t\td=Oct(pL.xyz,ftym-1.0)\/pL.w;\n\t}\n\tSrp(p,iCnt);\n\tif(ftym<1.0)p=mix(pL,p,ftym);\n\td=min(d,TubeFrame(p.xyz).x\/p.w);\n\treturn d;\n}\nvec4 mcol;\n#define fld vec3(1.,5.,2.)\nfloat AlienTechLikeThingy(in vec3 p,float x){\/\/from kali\n\tp=abs(0.5-fract(p*0.4+tym+x))*1.25;\n\tfloat l=0.0, expsmo=0.0,ot=1000.0;\n\tfor (int i = 0; i < 2; i++) { \n\t\tp=clamp(p,-fld,fld)*2.0-p;\n\t\tp*= -1.5\/min(dot(p, p)+0.005, 1.);\n\t\tp+= fld;\n\t\tfloat pl = l;\n\t\tl = length(p);\n\t\texpsmo+= exp(-1. \/ abs(l - pl));\n\t\tot=min(ot,l);\n\t\tp=clamp(p,-fld,fld)*2.0-p;\n\t\tp\/= min(dot(p, p)+0.01, 1.);\n\t\tp = p* -1.5 + fld;\n\t}\n\tmcol+=ud3*vec4(p.xyz,max(0., 2. - ot) )*0.5;\n\treturn ud3*expsmo;\n}\nfloat CE(in vec3 p0){\n\tfloat x=p0.x;\n\tvec4 p=vec4(p0,1.0);\/\/+sin(p0.yzx*10.0)*0.03*ud3\n\tint iCnt=0;\n\tfor (int n = 0; n < 3; n++) {\n\t\tif(n==iStop)break;\n\t\tif(n==2 && ud3>0.0)p.yz=rotate(p.yz,ud3);\n\t\tSrp(p,iCnt);\n\t}\n\tvec4 pL=p;\n\tfloat d=100.0;\n\tif(ftym>1.0 && iCnt>1){\n\t\tpL.x+=ftym-2.0;\n\t\td=Oct(pL.xyz,ftym-1.0)\/pL.w;\n\t}\n\tSrp(p,iCnt);\n\tif(ftym<1.0)p=mix(pL,p,ftym);\n\tvec2 d2=TubeFrame(p.xyz);\n\td2.x\/=p.w;\n\tif(d2.x<d){\n\t\tmcol+=vec4(vec3(4.0*(1.0-abs(fract(d2.y*4.0)-0.5))),-3.0+d2.y);\/\/abs(sin(d2.y*10.0))),-3.0+d2.y);\n\t\td=d2.x;\n\t}else{\n\t\tif(ud3>0.0)d-=AlienTechLikeThingy(pL.xyz*3.0,x)*0.0325;\n\t}\n\treturn d;\n}\n\nfloat rand(vec2 co){\/\/from Dave Hoskins\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\nvec2 rand2(vec2 co){\n    return fract(sin(vec2(dot(co.xy ,vec2(12.9898,78.233)),dot(co.yx,vec2(13.1898,73.231)))) * 43758.5453);\n}\n\nfloat stars(in vec2 p){\n\tfloat d=1.0;\n\tp=p*3.0;\n\tvec2 c=floor(p),f=fract(p),v=vec2(60.0,10.0);\n\tvec2 r=rand2(c)*0.8-f+0.1;\n\tr*=1.0+rand(c.yx);\n\td=min(d,min(length(r*v),length(r*v.yx)));\n\tp=p*(10.0-abs(p.y)*2.0);\n\tc=floor(p);f=fract(p);\n\tr=rand2(c)*0.9-f+0.05;\n\tr*=1.0+rand(c.yx);\n\td=min(d,10.0*length(r));\n\treturn d;\n}\nvec3 Space(in vec3 rd){\n\tvec2 p=vec2(atan(rd.z,rd.x)*1.4,rd.y);\n\tfloat d=stars(p);\n\tvec3 col=vec3(1.0-d-abs(rd.y)*2.0)+rd*0.1;\n\td=pow(max(0.0,dot(SUN,rd)),100.0);\n\tcol+=mix(vec3(0.0,0.2,0.0),10.0*vec3(1.0,0.7,0.4),d);\n\td=pow(max(0.0,dot(SUN.zyx,rd)),200.0);\n\tcol=mix(col,vec3(0.0),d*0.2);\n\treturn col;\n}\n\nfloat Waves(vec2 p, float tm){\n\tfloat h=0.0;\n\tmat2 m=mat2(0.78,1.21,-1.21,0.78);\n\tp+=3.0*sin(p.yx*0.1);\n\tfor(float i=2.0;i<5.0;i+=1.0){\n\t\th+=sin(p.x+sin(p.y+11.0*tm)+tm)\/i;\n\t\tp=p*m;\n\t}\n\treturn clamp(h*0.5+0.75,0.0,1.0);\n}\nfloat shad(in vec3 ro, in vec3 rd, float rnd){\n\tfloat t=abs(DE(ro))*rnd;\n\tfor(int i=0;i<14;i++){\n\t\tt+=abs(DE(ro+rd*t));\n\t}\n\treturn clamp(t,0.0,1.0);\n}\nvec3 scene(in vec3 ro, in vec3 rd, in vec2 uv){\n\tvec3 col=Space(rd),V=normalize(ro)+rd;\n\tfloat rnd=rand(uv),t=rnd*DE(ro),d,dm=0.25,g=0.0;\n\tfor(int i=0;i<48;i++){\n\t\tt+=d=DE(ro+rd*t);\n\t\tdm=min(d,dm);\n\t\tg+=0.04+0.005*rnd;\n\t\tif(t>6.0 || d<0.002)break;\n\t}\n\tg*=g;\n\tif(d<0.01){\t\n\t\tmcol=vec4(0.0);g*=0.5;\n\t\tvec2 v=vec2(0.005,0.0);\n\t\tro+=rd*t;\n\t\tvec3 N=normalize(vec3(CE(ro+v.xyy)-CE(ro-v.xyy),CE(ro+v.yxy)-CE(ro-v.yxy),CE(ro+v.yyx)-CE(ro-v.yyx)));\n\t\tvec3 R=reflect(rd,N);\n\t\tmcol.rgb=abs(sin(mcol.rgb))*0.25+0.5;\n\t\tcol=mcol.rgb*max(0.0,dot(-rd,N))*0.2+mcol.rgb*max(0.0,dot(N,SUN))*shad(ro+N*0.01,SUN,rnd);\n\t\tif(mcol.w>=0.0){\n\t\t\tcol+=clamp(Space(R)*0.5,0.0,0.5);\n\t\t\tcol+=pow(min(mcol.w,1.0), 4.0) * vec3(1.0,0.5,0.1) * (1.0 + sin(tym * 5.0 - ro.y * 10.0) );\/\/stolen from kali\n\t\t}else{\n\t\t\tif(tym<6.0)col+=abs(vec3(sin(tym*6.0),1.0,cos(tym*6.0)))*clamp(mcol.w+10.0*sin(tym*20.0+ro.z+ro.y),0.0,1.0);\n\t\t}\n\t}else{\n\t\tV=normalize(V);\n\t\tuv=-vec2(atan(V.z,V.x),V.y);\n\t\tg*=mix(Waves(uv*20.0,tym*5.0),1.0,min(dm*4.0+(0.4-ud3)*2.5,1.0));\n\t}\n\tcol+=vec3(0.3,0.6,1.0)*g;\n\treturn col;\n}\nmat3 lookat(vec3 fw){\n\tfw=normalize(fw);vec3 rt=normalize(cross(fw,vec3(0.0,1.0,0.0)));return mat3(rt,cross(rt,fw),fw);\n}\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n\tfloat tim=iGlobalTime;\n\tSetup(tim);\n\tvec2 uv=fragCoord.xy\/iResolution.xy;\n\ttim*=0.5;\n\tvec3 ro=vec3(cos(tim),cos(tim*0.3)*0.5,cos(tim*0.7))*min(0.5+tim*0.1+cos(tim*0.4)*0.5,1.5);\n\tvec3 rd=lookat(-ro)*normalize(vec3((fragCoord.xy-0.5*iResolution.xy)\/iResolution.y,1.0));\n\tvec3 color=scene(ro,rd,fragCoord.xy);\n\tcolor=clamp(color,0.0,min(tim,1.0));\n\tfragColor = vec4(color,1.0);\n}\n","name":"","description":"","type":"image"},{"inputs":[],"outputs":[{"channel":"0"}],"code":"\/\/chords to Space Oddity intro used without permission\n\n#define PI 3.1416\nfloat rnd(float t){return 2.0*(fract(sin(t+sin(t))*33113.31541)-.5);}\/\/from Dave Hoskins\nfloat noyz(float t){return mix(rnd(floor(t)),rnd(floor(t)+1.0),fract(t));}\n\n#define SPEEDOFSOUND 10.0\n#define DAMPING 1.0\nfloat snd(float time){\n\tfloat a1=noyz(700.0*time)*clamp(time*0.04-1.0,0.0,2.0);\n\tif(time<17.0)a1+=rnd(1764.6*time)*clamp(0.15-fract(time),0.0,1.0);\n\tif(time>17.0 && time<30.0)a1+=sin(time*2764.6*2.0)*clamp(sin(time*4.0)-0.5,0.0,1.0);\n\treturn a1;\n}\nfloat phys(float time, float dist){\n\tfloat tim=time-dist\/SPEEDOFSOUND;\n\treturn snd(tim)*exp(-dist*DAMPING);\n}\nvec3 herert(vec3 fw,vec3 up){\n\tfw=normalize(fw);return normalize(cross(fw,normalize(up)));\n}\n\n\n#define bps 3.0\n\n#define C1 261.63\n#define D1 293.66\n#define E1 329.63\n#define F1 349.23\n#define G1 392.0\n#define A1 440.0\n#define B1 493.88\n\nfloat amp(float t, float b){\n\tt-=b;\n\treturn clamp(t*10.0,0.0,1.0)*exp(-t);\n}\nfloat att(float t){\n\tt=mod(t,32.0);\n\tfloat a=0.0;\n\ta+=amp(t,0.0);\n\ta+=amp(t,3.0);\n\ta+=amp(t,4.0);\n\ta+=amp(t,7.0);\n\ta+=amp(t,9.0);\n\ta+=amp(t,10.0);\n\ta+=amp(t,13.0);\n\ta+=amp(t,14.0);\n\treturn a;\n}\nvec2 mainSound(float time)\n{\n\tfloat tim=time*bps,T=time*PI;\n\tfloat EMinor=sin(T*E1)+sin(T*G1)+sin(T*B1)+sin(T*2.0*D1)+sin(T*2.0*E1);\n\tfloat FMajor=sin(T*F1)+sin(T*A1)+sin(T*2.0*C1)+sin(T*2.0*F1);\n\tEMinor*=att(tim);\n\tFMajor*=att(tim+16.0);\n\t\t\n\ttim=time*0.5;\n\tvec3 ro=vec3(cos(tim),cos(tim*0.3)*0.5,cos(tim*0.7))*min(0.5+tim*0.1+cos(tim*0.4)*0.5,1.5);\n\tvec3 rd=-ro;\n\n\tvec3 rt=0.1*herert(rd,vec3(0.0,1.0,0.0));\n\tfloat d1=length(ro-rt),d2=length(ro+rt);\n\tfloat a1=phys(time,d1),a2=phys(time,d2);\n\n\treturn vec2(EMinor,FMajor)*0.2+vec2(a1,a2);\n}\n","name":"","description":"","type":"sound"}]}}