{"Shader":{"ver":"0.1","info":{"id":"XsS3Dc","date":"1394128115","viewed":853,"name":"truchet 3","username":"FabriceNeyret2","description":"variations upon https:\/\/www.shadertoy.com\/view\/4d2GzV<br\/>B: toggles border vs plain<br\/>C: toggles colors vs B&W<br\/>I: toggles inverse colors<br\/>H: toggles saturation","likes":12,"published":3,"flags":0,"tags":["truchet"],"hasliked":0},"renderpass":[{"inputs":[{"id":17,"src":"\/presets\/tex12.png","ctype":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"id":30,"src":"\/presets\/tex16.png","ctype":"texture","channel":1,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}},{"id":33,"src":"\/presets\/tex00.jpg","ctype":"keyboard","channel":2,"sampler":{"filter":"nearest","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}}],"outputs":[{"channel":"0"}],"code":"\/\/ inspired from https:\/\/www.shadertoy.com\/view\/4d2GzV#\n\n#define NB 10\n\nconst float s3 = 1.7320508075688772\/2.;  \/\/ sqrt(3)\/2\nconst float i3 = 0.5773502691896258;     \/\/ 1\/sqrt(3)\nconst mat2 tri2cart = mat2(1., 0.,   -.5,    s3);\nconst mat2 cart2tri = mat2(1., 0.,    i3, 2.*i3);\n\nfloat t = iGlobalTime;\n\nbool keyToggle(int ascii) \n{\n\treturn (texture2D(iChannel2,vec2((.5+float(ascii))\/256.,0.75)).x > 0.);\n}\n\n\nvec4 pick3(vec4 a, vec4 b, vec4 c, float u) {\n\tfloat v = fract(u\/3.);\n\treturn mix( mix(a, b, step(.3, v)), c, step(.6, v));\n}\n\nvec4 closestHexCenters(vec2 p) {\n\tvec2 pi = floor(p), pf = fract(p);\n\n\tvec4 nn = pick3(vec4(0., 0., 2.,  1.),\n\t\t\t\t\tvec4(1., 1., 0., -1.),\n\t\t\t\t\tvec4(1., 0., 0.,  1.),\n\t\t\t\t\tpi.x + pi.y);\n\t\n\treturn ( mix(nn, nn.yxwz, step(pf.x, pf.y)) + vec4(pi,pi));\t\n}\n\nfloat rnd(vec2 pos) {\n\treturn texture2D(iChannel0, fract(pos\/511.)).x;\n}\n\nfloat pattern(vec2 d,float s)\n{ return min(min(distance(d, vec2(-s  , 0.)), \n\t\t\t\t distance(d, vec2(s*.5, s3))), \n\t\t\t     distance(d, vec2(s*.5,-s3)));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\t\n\tfloat scl = .02*(1.3-1.*cos(.31*t)) * 200.\/iResolution.y;\n\tfloat cx = 2. * cos(t*.3) + 1.0 * cos(t*0.7+2.);\n\tfloat cy = 4. * sin(t*.4) + 0.3 * sin(t*1.2+4.);\n\tfloat theta = .05*t;\n\t\t\n\tvec2 pos = (fragCoord.xy - .5*iResolution.xy)*scl + vec2(cx, cy);\n\t\n\tfloat ct = cos(theta), st = sin(theta);\n\t\n\tfloat v=0., a=0.,  q=1.; vec3 col=vec3(0.);\n\tfor (int i=0; i<NB; i++)\n\t{\n\t\tvec2 pos2  = mat2(ct, -st, st, ct) * (pos+vec2(10.,0.));\n\t\tvec4 h = closestHexCenters(cart2tri*pos2);\n\t\tvec2 q1 = tri2cart * h.xy;\n\t\tfloat s = 2.*step(rnd(h.xy), 0.5) - 1.;\n\t\tpos2 -= q1;\n\t\tvec2 delta = 0.01*vec2(1.,0.);\n\t\tfloat l  = pattern(pos2          ,s);\n\t\tfloat lx = pattern(pos2+delta.xy ,s);\n\t\tfloat ly = pattern(pos2+delta.yx ,s);\n\t\tfloat r  = smoothstep(.1+2.\/q*scl, .1, abs(l-.5));\n\t\tfloat rx = smoothstep(.1+2.\/q*scl, .1, abs(lx-.5));\n\t\tfloat ry = smoothstep(.1+2.\/q*scl, .1, abs(ly-.5));\n\t\tfloat dr = length(vec2(rx-r,ry-r)*10.);\n\n\t\tfloat c = q * ((!keyToggle(66)) ? dr : r);\n\t\tif (keyToggle(72)) c = clamp(c,0.,1.);\n\n\t\tif (!keyToggle(67)) {\n\t\t\tvec3 t = texture2D(iChannel1,h.xy\/1000.).rgb;\n\t\t\tcol = mix(col, vec3(1.), (1.-a)*c*t); \n\t\t\tcol = clamp(col,0.,1.);\n\t\t}\n\t\telse {\n\t\t\tv = mix(v,1., (1.-a)*c); \n\t\t\tv = clamp(v,0.,1.);\n\t\t}\n\t\ta = mix(a,1., c);  a = clamp(a,0.,1.);\n\n\t\tpos *= 2.; q \/= 1.5;\n\t}\n\t\n\tif (keyToggle(67)) col = vec3(v);\n\tif (keyToggle(73)) col = 1.-col;\n\t\n\tfragColor = vec4(col,1.);\n\t\n}\n","name":"","description":"","type":"image"}]}}