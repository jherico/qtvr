{"Shader":{"ver":"0.1","info":{"id":"4sjGD1","date":"1387383649","viewed":7977,"name":"The Legend of Zelda","username":"HLorenzi","description":"Link wiping out some randomly-created Octoroks! Sometimes they collide <img src=\"\/img\/emoticonLaugh.png\"\/><br\/>This may actually work as a screensaver! (at least if the background changed a little)<br\/>Explaining the basic movement concept: https:\/\/www.shadertoy.com\/view\/Md2GW1","likes":63,"published":3,"flags":0,"tags":["2d","game","retro","sprite","nes","8","bit","dynamic","zelda","legend","nintendo"],"hasliked":0},"renderpass":[{"inputs":[{"id":13,"src":"\/presets\/mzk00.mp3","ctype":"music","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"false","srgb":"false","internal":"byte"}}],"outputs":[{"channel":"0"}],"code":"\/\/ The Legend of Zelda, by Henrique Lorenzi!\r\n\r\n\/\/ If it does not run at 60 FPS,\r\n\/\/ try pausing\/turning off the music!\r\n\r\n#define RGB(r,g,b) vec4(r\/255.,g\/255.,b\/255.,1)\r\n#define SPR(x,a,b,c,d,e,f,g,h, i,j,k,l,m,n,o,p) (x <= 7. ? SPR_H(a,b,c,d,e,f,g,h) : SPR_H(i,j,k,l,m,n,o,p))\r\n#define SPR_H(a,b,c,d,e,f,g,h) (a+4.0*(b+4.0*(c+4.0*(d+4.0*(e+4.0*(f+4.0*(g+4.0*(h))))))))\r\n#define SELECT(x,i) mod(floor(i\/pow(4.0,float(mod(float(x),8.0)))),4.0)\r\n\r\nfloat hash(float x)\r\n{\r\n    return fract(sin(x) * 43758.5453) * 2.0 - 1.0;\r\n}\r\n\r\nvec2 hashPos(float x)\r\n{\r\n\treturn vec2(\r\n\t\tfloor(hash(x) * 3.0) * 32.0 + 16.0,\r\n\t\tfloor(hash(x * 1.1) * 2.0) * 32.0 + 16.0\r\n\t);\r\n}\r\n\r\nvec4 fragColor;\r\n\r\nvoid spr_rock(float x, float y)\r\n{\r\n\tfloat c = 0.;\r\n\tif (y == 0.) c = (x < 8. ? 592. : 0.); if (y == 1.) c = (x < 8. ? 2388. : 0.);\r\n\tif (y == 2.) c = (x < 8. ? 26948. : 165.); if (y == 3.) c = (x < 8. ? 18769. : 597.);\r\n\tif (y == 4.) c = (x < 8. ? 18769. : 2645.); if (y == 5.) c = (x < 8. ? 21073. : 2389.);\r\n\tif (y == 6.) c = (x < 8. ? 21077. : 10582.); if (y == 7.) c = (x < 8. ? 21077. : 10902.);\r\n\tif (y == 8.) c = (x < 8. ? 21076. : 10646.); if (y == 9.) c = (x < 8. ? 21076. : 10650.);\r\n\tif (y == 10.) c = (x < 8. ? 21076. : 10650.); if (y == 11.) c = (x < 8. ? 22101. : 10905.);\r\n\tif (y == 12.) c = (x < 8. ? 22101. : 9877.); if (y == 13.) c = (x < 8. ? 21845. : 1449.);\r\n\tif (y == 14.) c = (x < 8. ? 25940. : 43685.); if (y == 15.) c = (x < 8. ? 43690. : 2730.);\r\n\t\r\n\tfloat s = SELECT(x,c);\r\n\tif (s == 0.) fragColor = RGB(252.,216.,168.);\r\n\tif (s == 1.) fragColor = RGB(192.,56.,0.);\r\n\tif (s == 2.) fragColor = RGB(0.,0.,0.);\r\n}\r\n\r\nvoid spr_tree(float x, float y)\r\n{\r\n\tfloat c = 0.;\r\n\tif (y == 0.) c = 0.; if (y == 1.) c = (x < 8. ? 37120. : 10.);\r\n\tif (y == 2.) c = (x < 8. ? 21776. : 681.); if (y == 3.) c = (x < 8. ? 22096. : 2469.);\r\n\tif (y == 4.) c = (x < 8. ? 21844. : 2709.); if (y == 5.) c = (x < 8. ? 25940. : 10853.);\r\n\tif (y == 6.) c = (x < 8. ? 21845. : 2725.); if (y == 7.) c = (x < 8. ? 21861. : 10901.);\r\n\tif (y == 8.) c = (x < 8. ? 21844. : 9878.); if (y == 9.) c = (x < 8. ? 22101. : 10901.);\r\n\tif (y == 10.) c = (x < 8. ? 21845. : 2729.); if (y == 11.) c = (x < 8. ? 21861. : 2661.);\r\n\tif (y == 12.) c = (x < 8. ? 38228. : 682.); if (y == 13.) c = (x < 8. ? 4416. : 26.);\r\n\tif (y == 14.) c = (x < 8. ? 512. : 43680.); if (y == 15.) c = (x < 8. ? 43648. : 2730.);\r\n\t\r\n\tfloat s = SELECT(x,c);\r\n\tif (s == 0.) fragColor = RGB(252.,216.,168.);\r\n\tif (s == 1.) fragColor = RGB(0.,156.,0.);\r\n\tif (s == 2.) fragColor = RGB(0.,0.,0.);\r\n}\r\n\r\nvoid spr_player_down(float f, float x, float y)\r\n{\r\n\tfloat c = 0.;\r\n\tif (f == 0.) {\r\n\t\tif (y == 0.) c = (x < 8. ? 21504. : 21.); if (y == 1.) c = (x < 8. ? 21760. : 85.);\r\n\t\tif (y == 2.) c = (x < 8. ? 64800. : 2175.); if (y == 3.) c = (x < 8. ? 65312. : 2303.);\r\n\t\tif (y == 4.) c = (x < 8. ? 39840. : 2790.); if (y == 5.) c = (x < 8. ? 48032. : 2798.);\r\n\t\tif (y == 6.) c = (x < 8. ? 43648. : 3754.); if (y == 7.) c = (x < 8. ? 59712. : 3435.);\r\n\t\tif (y == 8.) c = (x < 8. ? 45052. : 16218.); if (y == 9.) c = (x < 8. ? 32751. : 15957.);\r\n\t\tif (y == 10.) c = (x < 8. ? 61355. : 14999.); if (y == 11.) c = (x < 8. ? 28655. : 11007.);\r\n\t\tif (y == 12.) c = (x < 8. ? 61423. : 2391.); if (y == 13.) c = (x < 8. ? 28671. : 85.);\r\n\t\tif (y == 14.) c = (x < 8. ? 15016. : 252.); if (y == 15.) c = (x < 8. ? 16128. : 0.);\r\n\t\t\r\n\t\tfloat s = SELECT(x,c);\r\n\t\tif (s == 1.) fragColor = RGB(128.,208.,16.);\r\n\t\tif (s == 2.) fragColor = RGB(255.,160.,68.);\r\n\t\tif (s == 3.) fragColor = RGB(228.,92.,16.);\r\n\t}\r\n\tif (f == 1.) {\r\n\t\tif (y == 0.) c = (x < 8. ? 21504. : 21.); if (y == 1.) c = (x < 8. ? 21760. : 85.);\r\n\t\tif (y == 2.) c = (x < 8. ? 64800. : 2175.); if (y == 3.) c = (x < 8. ? 65312. : 2303.);\r\n\t\tif (y == 4.) c = (x < 8. ? 39840. : 2790.); if (y == 5.) c = (x < 8. ? 48032. : 2798.);\r\n\t\tif (y == 6.) c = (x < 8. ? 43648. : 3754.); if (y == 7.) c = (x < 8. ? 59648. : 3947.);\r\n\t\tif (y == 8.) c = (x < 8. ? 49136. : 2394.); if (y == 9.) c = (x < 8. ? 65468. : 2389.);\r\n\t\tif (y == 10.) c = (x < 8. ? 48812. : 863.); if (y == 11.) c = (x < 8. ? 49084. : 509.);\r\n\t\tif (y == 12.) c = (x < 8. ? 49084. : 351.); if (y == 13.) c = (x < 8. ? 49148. : 213.);\r\n\t\tif (y == 14.) c = (x < 8. ? 10912. : 252.); if (y == 15.) c = (x < 8. ? 0. : 252.);\r\n\t\t\r\n\t\tfloat s = SELECT(x,c);\r\n\t\tif (s == 1.) fragColor = RGB(128.,208.,16.);\r\n\t\tif (s == 2.) fragColor = RGB(255.,160.,68.);\r\n\t\tif (s == 3.) fragColor = RGB(228.,92.,16.);\r\n\t}\r\n\tif (f == 2.) {\r\n\t\tif (y == 0.) c = 0.; if (y == 1.) c = (x < 8. ? 41280. : 42.);\r\n\t\tif (y == 2.) c = (x < 8. ? 43472. : 170.); if (y == 3.) c = (x < 8. ? 23252. : 677.);\r\n\t\tif (y == 4.) c = (x < 8. ? 22261. : 12949.); if (y == 5.) c = (x < 8. ? 60917. : 15963.);\r\n\t\tif (y == 6.) c = (x < 8. ? 56791. : 3703.); if (y == 7.) c = (x < 8. ? 32348. : 1021.);\r\n\t\tif (y == 8.) c = (x < 8. ? 31344. : 381.); if (y == 9.) c = (x < 8. ? 60096. : 1375.);\r\n\t\tif (y == 10.) c = (x < 8. ? 43264. : 1370.); if (y == 11.) c = (x < 8. ? 26112. : 2389.);\r\n\t\tif (y == 12.) c = (x < 8. ? 23040. : 2646.); if (y == 13.) c = (x < 8. ? 26944. : 6781.);\r\n\t\tif (y == 14.) c = (x < 8. ? 41296. : 22207.); if (y == 15.) c = (x < 8. ? 0. : 21823.);\r\n\t\t\r\n\t\tfloat s = SELECT(x,c);\r\n\t\tif (s == 1.) fragColor = RGB(228.,92.,16.);\r\n\t\tif (s == 2.) fragColor = RGB(128.,208.,16.);\r\n\t\tif (s == 3.) fragColor = RGB(255.,160.,68.);\r\n\t}\r\n}\r\n\r\nvoid spr_player_up(float f, float x, float y)\r\n{\r\n\tfloat c = 0.;\r\n\tif (f == 0. || f == 1.) {\r\n\t\tif (f == 1.) x = 15. - x;\r\n\t\t\r\n\t\tif (y == 0.) c = (x < 8. ? 21504. : 21.); if (y == 1.) c = (x < 8. ? 21760. : 85.);\r\n\t\tif (y == 2.) c = (x < 8. ? 21792. : 2133.); if (y == 3.) c = (x < 8. ? 21856. : 2389.);\r\n\t\tif (y == 4.) c = (x < 8. ? 21984. : 2901.); if (y == 5.) c = (x < 8. ? 24480. : 2805.);\r\n\t\tif (y == 6.) c = (x < 8. ? 32640. : 765.); if (y == 7.) c = (x < 8. ? 64960. : 895.);\r\n\t\tif (y == 8.) c = (x < 8. ? 22000. : 981.); if (y == 9.) c = (x < 8. ? 22000. : 3029.);\r\n\t\tif (y == 10.) c = (x < 8. ? 22464. : 3029.); if (y == 11.) c = (x < 8. ? 64832. : 2687.);\r\n\t\tif (y == 12.) c = (x < 8. ? 21824. : 341.); if (y == 13.) c = (x < 8. ? 24512. : 213.);\r\n\t\tif (y == 14.) c = (x < 8. ? 16320. : 60.); if (y == 15.) c = (x < 8. ? 3840. : 0.);\r\n\t\t\r\n\t\tfloat s = SELECT(x,c);\r\n\t\tif (s == 1.) fragColor = RGB(128.,208.,16.);\r\n\t\tif (s == 2.) fragColor = RGB(255.,160.,68.);\r\n\t\tif (s == 3.) fragColor = RGB(228.,92.,16.);\r\n\t}\r\n\tif (f == 2.) {\r\n\t\tif (y == 0.) c = (x < 8. ? 43584. : 2.); if (y == 1.) c = (x < 8. ? 43660. : 10.);\r\n\t\tif (y == 2.) c = (x < 8. ? 43676. : 42.); if (y == 3.) c = (x < 8. ? 43708. : 810.);\r\n\t\tif (y == 4.) c = (x < 8. ? 43636. : 986.); if (y == 5.) c = (x < 8. ? 43380. : 49365.);\r\n\t\tif (y == 6.) c = (x < 8. ? 26004. : 28901.); if (y == 7.) c = (x < 8. ? 22164. : 23897.);\r\n\t\tif (y == 8.) c = (x < 8. ? 43664. : 22362.); if (y == 9.) c = (x < 8. ? 43664. : 21978.);\r\n\t\tif (y == 10.) c = (x < 8. ? 43616. : 5498.); if (y == 11.) c = (x < 8. ? 21924. : 1493.);\r\n\t\tif (y == 12.) c = (x < 8. ? 43685. : 938.); if (y == 13.) c = (x < 8. ? 32789. : 362.);\r\n\t\tif (y == 14.) c = (x < 8. ? 0. : 1360.); if (y == 15.) c = (x < 8. ? 0. : 1360.);\r\n\t\t\r\n\t\tfloat s = SELECT(x,c);\r\n\t\tif (s == 1.) fragColor = RGB(228.,92.,16.);\r\n\t\tif (s == 2.) fragColor = RGB(128.,208.,16.);\r\n\t\tif (s == 3.) fragColor = RGB(255.,160.,68.);\r\n\t}\r\n\t\r\n}\r\n\r\n\r\nvoid spr_player_left(float f, float x, float y)\r\n{\r\n\tfloat c = 0.;\r\n\tif (f == 0.) {\r\n\t\tif (y == 0.) c = (x < 8. ? 16384. : 21.); if (y == 1.) c = (x < 8. ? 43520. : 341.);\r\n\t\tif (y == 2.) c = (x < 8. ? 43648. : 5590.); if (y == 3.) c = (x < 8. ? 43520. : 22010.);\r\n\t\tif (y == 4.) c = (x < 8. ? 63240. : 17918.); if (y == 5.) c = (x < 8. ? 64504. : 1726.);\r\n\t\tif (y == 6.) c = (x < 8. ? 65288. : 687.); if (y == 7.) c = (x < 8. ? 65288. : 85.);\r\n\t\tif (y == 8.) c = (x < 8. ? 23224. : 2389.); if (y == 9.) c = (x < 8. ? 22200. : 10879.);\r\n\t\tif (y == 10.) c = (x < 8. ? 22152. : 10943.); if (y == 11.) c = (x < 8. ? 22536. : 10941.);\r\n\t\tif (y == 12.) c = (x < 8. ? 43016. : 1686.); if (y == 13.) c = (x < 8. ? 21504. : 5461.);\r\n\t\tif (y == 14.) c = (x < 8. ? 0. : 170.); if (y == 15.) c = (x < 8. ? 32768. : 170.);\r\n\t}\r\n\tif (f == 1.) {\r\n\t\tif (y == 0.) c = 0.; if (y == 1.) c = (x < 8. ? 20480. : 5.);\r\n\t\tif (y == 2.) c = (x < 8. ? 27264. : 85.); if (y == 3.) c = (x < 8. ? 43680. : 1397.);\r\n\t\tif (y == 4.) c = (x < 8. ? 43648. : 5502.); if (y == 5.) c = (x < 8. ? 48576. : 4479.);\r\n\t\tif (y == 6.) c = (x < 8. ? 48892. : 431.); if (y == 7.) c = (x < 8. ? 65480. : 171.);\r\n\t\tif (y == 8.) c = (x < 8. ? 32712. : 21.); if (y == 9.) c = (x < 8. ? 65208. : 421.);\r\n\t\tif (y == 10.) c = (x < 8. ? 64952. : 682.); if (y == 11.) c = (x < 8. ? 62856. : 1706.);\r\n\t\tif (y == 12.) c = (x < 8. ? 22024. : 1450.); if (y == 13.) c = (x < 8. ? 43592. : 10581.);\r\n\t\tif (y == 14.) c = (x < 8. ? 21920. : 10837.); if (y == 15.) c = 2688.;\r\n\t}\r\n\tif (f == 2.) {\r\n\t\tif (y == 0.) c = 0.; if (y == 1.) c = (x < 8. ? 21504. : 1.);\r\n\t\tif (y == 2.) c = (x < 8. ? 23200. : 21.); if (y == 3.) c = (x < 8. ? 27304. : 93.);\r\n\t\tif (y == 4.) c = (x < 8. ? 43680. : 95.); if (y == 5.) c = (x < 8. ? 61296. : 351.);\r\n\t\tif (y == 6.) c = (x < 8. ? 61375. : 1387.); if (y == 7.) c = (x < 8. ? 65520. : 1066.);\r\n\t\tif (y == 8.) c = (x < 8. ? 24572. : 21.); if (y == 9.) c = (x < 8. ? 43772. : 90.);\r\n\t\tif (y == 10.) c = (x < 8. ? 43760. : 106.); if (y == 11.) c = (x < 8. ? 43584. : 362.);\r\n\t\tif (y == 12.) c = (x < 8. ? 38304. : 1370.); if (y == 13.) c = (x < 8. ? 27296. : 10581.);\r\n\t\tif (y == 14.) c = (x < 8. ? 21864. : 10837.); if (y == 15.) c = (x < 8. ? 170. : 2688.);\r\n\t}\r\n\t\r\n\tfloat s = SELECT(x,c);\r\n\tif (s == 1.) fragColor = RGB(128.,208.,16.);\r\n\tif (s == 2.) fragColor = RGB(228.,92.,16.);\r\n\tif (s == 3.) fragColor = RGB(255.,160.,68.);\r\n}\r\n\r\nvoid spr_player_right(float f, float x, float y)\r\n{\r\n\tspr_player_left(f, 15. - x, y);\r\n}\r\n\r\nvoid spr_sword(float f, float tDirX, float tDirY, float x, float y)\r\n{\r\n\tif (f < 4. || f > 32.) return;\r\n\t\r\n\tif (tDirX > 0.) {x = 15. - x;}\r\n\tif (tDirY > 0.) {float temp = y; y = x; x = temp;}\r\n\tif (tDirY < 0.) {float temp = y; y = x; x = 15. - temp;}\r\n\t\r\n\tif (f < 5. || f > 28.) {if (x < 10.) {x -= 4.;}}\r\n\t\r\n\tif (x < 0.) return;\r\n\t\r\n\tfloat c = 0.;\r\n\tif (y == 0.) c = 0.; if (y == 1.) c = 0.;\r\n\tif (y == 2.) c = 0.; if (y == 3.) c = 0.;\r\n\tif (y == 4.) c = 0.; if (y == 5.) c = (x < 8. ? 0. : 20480.);\r\n\tif (y == 6.) c = (x < 8. ? 0. : 4096.); if (y == 7.) c = (x < 8. ? 43520. : 39594.);\r\n\tif (y == 8.) c = (x < 8. ? 43648. : 39594.); if (y == 9.) c = (x < 8. ? 43520. : 39594.);\r\n\tif (y == 10.) c = (x < 8. ? 0. : 4096.); if (y == 11.) c = (x < 8. ? 0. : 20480.);\r\n\tif (y == 12.) c = 0.; if (y == 13.) c = 0.;\r\n\tif (y == 14.) c = 0.; if (y == 15.) c = 0.;\r\n\t\r\n\tfloat s = SELECT(x,c);\r\n\tif (s == 1.) fragColor = RGB(128.,208.,16.);\r\n\tif (s == 2.) fragColor = RGB(228.,92.,16.);\r\n\r\n}\r\n\r\nvoid spr_enemy(float f, float tDirX, float tDirY, float x, float y)\r\n{\r\n\t\r\n\tif (tDirX > 0.) {x = 15. - x;}\r\n\tif (tDirY > 0.) {float temp = y; y = x; x = 15. - temp;}\r\n\tif (tDirY < 0.) {float temp = y; y = x; x = temp;}\r\n\t\r\n\tif (y >= 8.) y = 15. - y;\r\n\t\r\n\tfloat c = 0.;\r\n\tif (f == 0.) {\r\n\t\tif (y == 0.) c = (x < 8. ? 16384. : 4160.); if (y == 1.) c = (x < 8. ? 16384. : 5201.);\r\n\t\tif (y == 2.) c = (x < 8. ? 16640. : 1365.); if (y == 3.) c = (x < 8. ? 21760. : 5466.);\r\n\t\tif (y == 4.) c = (x < 8. ? 42000. : 5610.); if (y == 5.) c = (x < 8. ? 25680. : 30053.);\r\n\t\tif (y == 6.) c = (x < 8. ? 22864. : 22361.); if (y == 7.) c = (x < 8. ? 43344. : 54618.);\r\n\t\t\r\n\t\tfloat s = SELECT(x,c);\r\n\t\tif (s == 1.) fragColor = RGB(224.,80.,0.);\r\n\t\tif (s == 2.) fragColor = RGB(255.,255.,255.);\r\n\t\tif (s == 3.) fragColor = RGB(255.,160.,0.);\r\n\t}\r\n\tif (f == 1.) {\r\n\t\tif (y == 0.) c = (x < 8. ? 0. : 1040.); if (y == 1.) c = (x < 8. ? 20480. : 1300.);\r\n\t\tif (y == 2.) c = (x < 8. ? 16384. : 1365.); if (y == 3.) c = (x < 8. ? 21760. : 5466.);\r\n\t\tif (y == 4.) c = (x < 8. ? 42241. : 5610.); if (y == 5.) c = (x < 8. ? 25601. : 30053.);\r\n\t\tif (y == 6.) c = (x < 8. ? 22869. : 22361.); if (y == 7.) c = (x < 8. ? 43349. : 54618.);\r\n\t\t\r\n\t\tfloat s = SELECT(x,c);\r\n\t\tif (s == 1.) fragColor = RGB(224.,80.,0.);\r\n\t\tif (s == 2.) fragColor = RGB(255.,255.,255.);\r\n\t\tif (s == 3.) fragColor = RGB(255.,160.,0.);\r\n\t}\r\n\t\r\n\tif (x >= 8.) x = 15. - x;\r\n\tif (y >= 8.) y = 15. - y;\r\n\tif (f == 2. || f == 5. || f == 7.) {\t\t\r\n\t\tif (y == 0.) c = 0.; if (y == 1.) c = 0.;\r\n\t\tif (y == 2.) c = 0.; if (y == 3.) c = (x < 8. ? 64. : 0.);\r\n\t\tif (y == 4.) c = (x < 8. ? 32768. : 0.); if (y == 5.) c = (x < 8. ? 17408. : 0.);\r\n\t\tif (y == 6.) c = (x < 8. ? 32768. : 0.); if (y == 7.) c = (x < 8. ? 26112. : 0.);\r\n\t\t\r\n\t\tfloat s = SELECT(x,c);\r\n\t\tif (mod(floor(iGlobalTime * 10.),2.) == 0.) {\r\n\t\t\tif (s == 2.) s = 1.;\r\n\t\t\telse if (s == 1.) s= 2.;\r\n\t\t}\r\n\t\t\r\n\t\tif (s == 1.) fragColor = RGB(255.,255.,255.);\r\n\t\tif (s == 2.) fragColor = RGB(104.,136.,255.);\r\n\t}\r\n\tif (f == 3. || f == 6.) {\r\n\t\tif (y == 0.) c = 0.; if (y == 1.) c = (x < 8. ? 4. : 0.);\r\n\t\tif (y == 2.) c = (x < 8. ? 32. : 0.); if (y == 3.) c = (x < 8. ? 32832. : 0.);\r\n\t\tif (y == 4.) c = (x < 8. ? 33024. : 0.); if (y == 5.) c = (x < 8. ? 17408. : 0.);\r\n\t\tif (y == 6.) c = (x < 8. ? 40960. : 0.); if (y == 7.) c = (x < 8. ? 26240. : 0.);\r\n\t\t\r\n\t\tfloat s = SELECT(x,c);\r\n\t\tif (mod(floor(iGlobalTime * 10.),2.) == 0.) {\r\n\t\t\tif (s == 2.) s = 1.;\r\n\t\t\telse if (s == 1.) s= 2.;\r\n\t\t}\r\n\t\t\r\n\t\tif (s == 1.) fragColor = RGB(255.,255.,255.);\r\n\t\tif (s == 2.) fragColor = RGB(104.,136.,255.);\r\n\r\n\t}\r\n}\r\n\r\n\r\nvoid background(vec2 p)\r\n{\r\n\tfloat tileX = floor((p.x - 8.0) \/ 16.0);\r\n\tfloat tileY = floor((p.y - 8.0) \/ 16.0);\r\n\tfloat pixelX = mod((p.x - 8.0), 16.0);\r\n\tfloat pixelY = 15.0 - mod((p.y - 8.0), 16.0);\r\n\t\r\n\tif ((tileX >= -4. && tileX <= 2. && tileY >= -2. && tileY <= 0.) ||\r\n\t\t(tileX == -5. && tileY == 1.) ||\r\n\t\t(tileX == -5. && tileY == -3.) ||\r\n\t\t(tileX == 3. && tileY == 1.) ||\r\n\t\t(tileX == 3. && tileY == -3.) ||\r\n\t\t\r\n\t\t(tileX == 5. && tileY == -1.) ||\r\n\t\t(tileX == -1. && tileY == -3.) ||\r\n\t\t(tileX == -7. && tileY == -1.) ||\r\n\t\t((mod(tileX, 2.0) == 0. || mod(tileY, 2.0) == 0.) &&\r\n\t   ((tileX >= -6. && tileX <= 4.) || (tileY >= -4. && tileY <= 2.)))) {\r\n\t\t\t\r\n\t\t\tif (mod(pixelX * 5.5 + pixelY * 4.,21.) == 0.)\r\n\t\t\t\tfragColor = mix(RGB(252.,206.,168.),RGB(252.,196.,118.),length(p \/ 256.));\r\n\t\t\telse\r\n\t\t\t\tfragColor = RGB(252.,216.,168.);\r\n\t} else {\r\n\t\tif (tileX >= -5. && tileX <= 3. && tileY >= -3. && tileY <= 2.)\r\n\t\t\tspr_tree(pixelX,pixelY);\r\n\t\telse\r\n\t\t\tspr_rock(pixelX,pixelY);\r\n\t}\r\n}\r\n\r\nvoid mainImage( out vec4 oFragColor, in vec2 fragCoord )\r\n{\r\n\tfloat size = 2.;\r\n\tif (iResolution.y < 200.) size = 1.;\r\n\tif (iResolution.y > 600.) size = 4.;\r\n\tvec2 uv = floor((fragCoord.xy - iResolution.xy \/ 2.0) \/ size);\r\n\t\r\n\t\r\n\t\r\n\tbackground(uv);\r\n\t\r\n\t\r\n\tfloat time = floor(iGlobalTime * 60.0);\r\n\t\r\n\tconst float walkTime = 60.0 * 5.0;\r\n\tfloat walkIndex = floor(time \/ walkTime);\r\n\tfloat walkFrame = mod(time, walkTime);\r\n\t\r\n\tvec2 lastPlayerPos = hashPos(walkIndex - 1.);\r\n\tvec2 curPlayerPos = hashPos(walkIndex);\r\n\tvec2 playerPos = lastPlayerPos;\r\n\t\r\n\tfloat dirX = 0., dirXRand = 0.;\r\n\tfloat dirY = 0., dirYRand = 0.;\r\n\tfloat dirRand = floor(abs(hash(floor(time \/ 50.0))) * 4.0);\r\n\tif (dirRand == 0.) dirXRand = 1.;\r\n\telse if (dirRand == 1.) dirXRand = -1.;\r\n\telse if (dirRand == 2.) dirYRand = 1.;\r\n\telse dirYRand = -1.;\r\n\t\r\n\tfloat frame = floor(mod(time \/ 6.0,2.0));\r\n\tfloat swordFrame = 0.;\r\n\t\r\n\tif (hash(walkIndex * 3.84) < 0.) {\r\n\t\tfloat yDisp = abs(lastPlayerPos.y - curPlayerPos.y);\r\n\t\tfloat xDisp = abs(lastPlayerPos.x - curPlayerPos.x);\r\n\t\tfloat ySign = sign(curPlayerPos.y - lastPlayerPos.y);\r\n\t\tfloat xSign = sign(curPlayerPos.x - lastPlayerPos.x);\r\n\t\t\r\n\t\tif (walkFrame < yDisp) {\r\n\t\t\tplayerPos = vec2(lastPlayerPos.x,lastPlayerPos.y + ySign * walkFrame);\r\n\t\t\tdirY = ySign;\r\n\t\t} else if (walkFrame < yDisp + xDisp - 16.0) {\r\n\t\t\tplayerPos = vec2(lastPlayerPos.x + xSign * (walkFrame - yDisp),curPlayerPos.y);\r\n\t\t\tdirX = xSign;\r\n\t\t} else if (walkFrame < yDisp + xDisp - 16.0 + 40.0) {\r\n\t\t\tdirX = xSign;\r\n\t\t\tframe = 2.;\r\n\t\t\tswordFrame = walkFrame - (yDisp + xDisp - 16.0);\r\n\t\t\tplayerPos = vec2(lastPlayerPos.x + xSign * (xDisp - 16.0),curPlayerPos.y);\r\n\t\t} else if (walkFrame < yDisp + xDisp - 16.0 + 56.0) {\r\n\t\t\tdirX = xSign;\r\n\t\t\tplayerPos = vec2(lastPlayerPos.x + xSign * (walkFrame - (yDisp - 16.0 + 56.0)),curPlayerPos.y);\r\n\t\t} else {\r\n\t\t\tframe = 0.;\r\n\t\t\tif (walkFrame < yDisp + xDisp - 16.0 + 90.) dirX = xSign;\r\n\t\t\tplayerPos = curPlayerPos;\r\n\t\t}\r\n\t} else {\r\n\t\tfloat yDisp = abs(lastPlayerPos.y - curPlayerPos.y);\r\n\t\tfloat xDisp = abs(lastPlayerPos.x - curPlayerPos.x);\r\n\t\tfloat ySign = sign(curPlayerPos.y - lastPlayerPos.y);\r\n\t\tfloat xSign = sign(curPlayerPos.x - lastPlayerPos.x);\r\n\t\t\r\n\t\tif (walkFrame < xDisp) {\r\n\t\t\tdirX = xSign;\r\n\t\t\tplayerPos = vec2(lastPlayerPos.x + xSign * walkFrame,lastPlayerPos.y);\r\n\t\t} else if (walkFrame < yDisp + xDisp - 16.0) {\r\n\t\t\tdirY = ySign;\r\n\t\t\tplayerPos = vec2(curPlayerPos.x,lastPlayerPos.y + ySign * (walkFrame - xDisp));\r\n\t\t} else if (walkFrame < yDisp + xDisp - 16.0 + 40.0) {\r\n\t\t\tframe = 2.;\r\n\t\t\tswordFrame = walkFrame - (yDisp + xDisp - 16.0);\r\n\t\t\tdirY = ySign;\r\n\t\t\tplayerPos = vec2(curPlayerPos.x,lastPlayerPos.y + ySign * (yDisp - 16.0));\r\n\t\t} else if (walkFrame < yDisp + xDisp - 16.0 + 56.0) {\r\n\t\t\tdirY = ySign;\r\n\t\t\tplayerPos = vec2(curPlayerPos.x,lastPlayerPos.y + ySign * (walkFrame - (xDisp - 16.0 + 56.0)));\r\n\t\t} else {\r\n\t\t\tframe = 0.;\r\n\t\t\tif (walkFrame < yDisp + xDisp - 16.0 + 90.) dirY = ySign;\r\n\t\t\tplayerPos = curPlayerPos;\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tif (dirX == 0. && dirY == 0.) {\r\n\t\tdirY = dirYRand;\r\n\t\tdirX = dirXRand;\r\n\t\tframe = 0.;\r\n\t}\r\n\t\r\n\tconst int enemyNum = 3;\r\n\tfor(int i = 0; i < enemyNum; i++) {\r\n\t\tfloat wi = walkIndex + float(i);\r\n\t\tvec2 eLastPos = hashPos(wi - 1.);\r\n\t\tvec2 eCurPos = hashPos(wi);\r\n\t\tvec2 ePos = vec2(0,0);\r\n\t\t\r\n\t\tfloat eDirX = 0.;\r\n\t\tfloat eDirY = 0.;\r\n\t\t\r\n\t\tfloat yDisp = abs(eCurPos.y - eLastPos.y);\r\n\t\tfloat xDisp = abs(eCurPos.x - eLastPos.x);\r\n\t\tfloat ySign = sign(eCurPos.y - eLastPos.y);\r\n\t\tfloat xSign = sign(eCurPos.x - eLastPos.x);\r\n\t\t\r\n\t\tfloat eFrame = floor(mod((time + 2.5) \/ 6.0,2.0));\r\n\t\t\r\n\t\tif (hash(wi * 3.84) < 0.) {\r\n\t\t\tif (eLastPos.x != eCurPos.x) {\r\n\t\t\t\tfloat s = (hash(wi) < 0. ? 1. : -1.);\r\n\t\t\t\tfloat y = (xDisp + yDisp - (walkFrame - walkTime * float(i)));\r\n\t\t\t\tfloat yc = abs(hash(wi)) * 64. + 64.;\r\n\t\t\t\t\r\n\t\t\t\tif (y < 0.) {\r\n\t\t\t\t\tePos = eCurPos;\r\n\t\t\t\t\teDirY = s;\r\n\t\t\t\t\teFrame = 2. + floor(abs(y \/ 5.));\r\n\t\t\t\t} else if (y < yc) {\r\n\t\t\t\t\tePos = vec2(eCurPos.x, eCurPos.y + s * yc + s * (y - yc));\r\n\t\t\t\t\teDirY = s;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tePos = vec2(eCurPos.x, eCurPos.y + s * yc - s * (y - yc));\r\n\t\t\t\t\teDirY = -s;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (eLastPos.y != eCurPos.y) {\r\n\t\t\t\tfloat s = (hash(wi) < 0. ? 1. : -1.);\r\n\t\t\t\tfloat x = (xDisp + yDisp - (walkFrame - walkTime * float(i)));\r\n\t\t\t\tfloat xc = abs(hash(wi)) * 64. + 64.;\r\n\t\t\t\t\r\n\t\t\t\tif (x < 0.) {\r\n\t\t\t\t\tePos = eCurPos;\r\n\t\t\t\t\teDirX = s;\r\n\t\t\t\t\teFrame = 2. + floor(abs(x \/ 5.));\r\n\t\t\t\t} else if (x < xc) {\r\n\t\t\t\t\tePos = vec2(eCurPos.x + s * xc + s * (x - xc), eCurPos.y);\r\n\t\t\t\t\teDirX = -s;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tePos = vec2(eCurPos.x + s * xc - s * (x - xc), eCurPos.y);\r\n\t\t\t\t\teDirX = s;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tePos = floor(ePos);\r\n\t\t\r\n\t\tif ((eDirX != 0. || eDirY != 0.) &&\r\n\t\t\tuv.x >= ePos.x - 8. && uv.x <= ePos.x + 7. &&\r\n\t\t\tuv.y >= ePos.y - 8. && uv.y <= ePos.y + 7.) {\r\n\t\t\t\tfloat epx = uv.x - ePos.x + 8.;\r\n\t\t\t\tfloat epy = ePos.y - uv.y + 7.;\r\n\t\t\t\tspr_enemy(eFrame, eDirX, eDirY, epx, epy);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tif (frame == 2.) {\r\n\t\tfloat spx = 0.;\r\n\t\tfloat spy = 0.;\r\n\t\tif (dirX > 0.) {spx = 15.; spy = -1.;}\r\n\t\tif (dirX < 0.) {spx = -15.; spy = -1.;}\r\n\t\tif (dirY > 0.) {spx = -3.; spy = 15.;}\r\n\t\tif (dirY < 0.) {spx = 1.; spy = -15.;}\r\n\t\t\r\n\t\tif (uv.x >= playerPos.x - 8. + spx && uv.x <= playerPos.x + 7. + spx &&\r\n\t\t\tuv.y >= playerPos.y - 7. + spy && uv.y <= playerPos.y + 8. + spy) {\r\n\t\t\t\r\n\t\t\tfloat sx = uv.x - playerPos.x + 8. - spx;\r\n\t\t\tfloat sy = playerPos.y - uv.y + 8. + spy;\r\n\t\t\tspr_sword(swordFrame,dirX,dirY,sx,sy);\r\n\t\t}\r\n\t}\r\n\t\r\n\tif (uv.x >= playerPos.x - 8. && uv.x <= playerPos.x + 7. &&\r\n\t\tuv.y >= playerPos.y - 7. && uv.y <= playerPos.y + 8.) {\r\n\t\t\tfloat px = uv.x - playerPos.x + 8.;\r\n\t\t\tfloat py = playerPos.y - uv.y + 8.;\r\n\t\t\r\n\t\t\tif (dirX > 0.) spr_player_right(frame,px,py);\r\n\t\t\tif (dirX < 0.) spr_player_left(frame,px,py);\r\n\t\t\tif (dirY > 0.) spr_player_up(frame,px,py);\r\n\t\t\tif (dirY < 0.) spr_player_down(frame,px,py);\r\n\t}\r\n\t\r\n    oFragColor = fragColor;\r\n}","name":"","description":"","type":"image"}]}}