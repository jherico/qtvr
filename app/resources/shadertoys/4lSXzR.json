{"Shader":{"ver":"0.1","info":{"id":"4lSXzR","date":"1440955127","viewed":840,"name":"Flower at night","username":"yibojiang","description":"experiment math painting <img src=\"\/img\/emoticonHappy.png\"\/>","likes":18,"published":3,"flags":0,"tags":["flower","pattern"],"hasliked":0},"renderpass":[{"inputs":[{"id":16,"src":"\/presets\/tex11.png","ctype":"texture","channel":0,"sampler":{"filter":"mipmap","wrap":"repeat","vflip":"false","srgb":"false","internal":"byte"}}],"outputs":[{"channel":"0"}],"code":"\/\/yibojiang, 2015-8-30\n#define pi 3.1415926535897932384626433832795\n#define flyCount 30.\n\nfloat testFuncFloor(float v){\n\n    const float amplitude=1.;\n    const float t=pi*2.;\n    float k=4.*amplitude\/t;\n    float r=mod( v  ,t);\n    float d=floor(v \/(.5* t) );\n    \n\treturn mix(k* r-amplitude ,  amplitude*3.-k* r ,mod(d,2.)  );\n\n}\n\nfloat getRad(vec2 q){\n   return atan(q.y,q.x); \n}\n\nvec2 noise(vec2 tc){\n    return (2.*texture2D(iChannel0, tc).xy-1.).xy;\n}\n\nfloat firefly(vec2 p,float size){\n    \n\t\/\/return smoothstep(0.,size,dot(p,p)*200. );\n\treturn smoothstep(0.,size,length(p) );\n\n}\n\nconst float pow=1.;\nconst float flySpeed=0.1;\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n   \/\/ float pow=1.;\n    const float duration=1.;\n    float t=duration*(1.+sin(3.* iGlobalTime ) );\n\n\tvec2 p= fragCoord.xy \/ iResolution.xy;\n   \n\tfloat ratio= iResolution.y\/iResolution.x;\n    \n     vec2 uv=p;\n    uv.y*=ratio;\n    \n    \n    vec2 flowerP=vec2(.618,0.518);\n    vec2 q=p-flowerP-vec2( pow*.008*cos(3.*iGlobalTime) ,pow*.008*sin(3.*iGlobalTime) ) ;\n    vec2 rootP=p-+flowerP-vec2( pow*.02*cos(3.*iGlobalTime)*p.y ,-0.48+pow*.008*sin(3.*iGlobalTime) );\n   \n\tq.y*=ratio;\n\t\n    \/\/sky\n    vec3 col=mix( vec3(0.1,0.6,0.5), vec3(0.2,0.1,0.2), sqrt(p.y)*.6 );\n    \n\n   \t\/\/draw stem \n    float width=0.01;\n    float h=.5;\n    float w=.0005;\n    col=mix(vec3(.5,.7,.4),col, 1.- (1.- smoothstep(h,h+width, abs(rootP.y ) )  ) * (1.- smoothstep(w,w+width, abs(rootP.x-0.1*sin(4.*rootP.y+pi*.35) ) )  ) );\n   \t\n    \/\/draw flower \n    vec3 flowerCol=mix(vec3(.7,.7,.2),vec3(.7,.9,.7), smoothstep( .0,1.,length(q)*10. ) ) ;\n\n    const float edge=.02;\n    float r= .1+0.05*( testFuncFloor( getRad( q ) *7.  + 2.*q.x*(t-duration)  )  );\n\n\tcol=mix(flowerCol,col, smoothstep(r,r+edge,  length( q )  ) );\n    \n\t\/\/draw buds\n    float r1=0.;\n    r1=.04;\n    vec3 budCol=mix (vec3(.3,.4,0.),vec3(.9,.8,0.), length(q)*10. );\n\tcol=mix(budCol,col, smoothstep(r1,r1+0.01,  length( q )  ) );\n    \n    \/\/draw firefly\n\t\/\/vec3 flyCol=mix (vec3(.1,.4,0.1),vec3(.1,1.,1.), length(q)*10. );\n\t\n    for (float i=0.;i<flyCount;i++){\n\t\t\n        float seed=i\/flyCount;\n        float t1=1.*(1.+sin(noise(vec2(seed) ).x* iGlobalTime ) );\n\t    vec2 fireflyP=uv- vec2(noise(vec2(seed) ).x+noise(vec2(seed) ).y*t1*flySpeed,noise(vec2(seed) ).y+noise(vec2(seed) ).y*t1*flySpeed);\n\t\tfloat fly= firefly( fireflyP,.002+.008*seed );\n  \t\tvec3 flyCol=mix(vec3(0.1,0.9,0.1)*t1,vec3(0.), fly );\n   \t\tcol+=flyCol;\n    }\n    fragColor=vec4(col,0.);\n}","name":"","description":"","type":"image"}]}}