{"Shader":{"ver":"0.1","info":{"id":"4lS3zw","date":"1427467994","viewed":913,"name":"Wire Eggs","username":"eiffie","description":"The chickens aren't that thrilled either.","likes":26,"published":3,"flags":8,"tags":["eggs"],"hasliked":0},"renderpass":[{"inputs":[],"outputs":[{"channel":"0"}],"code":"\/\/Wire Eggs by eiffie (ft. polyfold by knighty)\n\/\/creative commons blahblahblah\n\nfloat rnd;\nvoid randomize(in vec2 p){rnd=fract(sin(dot(p,vec2(13.3145,17.7391)))*317.7654321);}\n\n#define Type 5\n#define PI 3.14159\nvec3 nc;\n\nvoid Init(){\/\/polyfold from knighty https:\/\/www.shadertoy.com\/view\/XlX3zB\n\t float cospin=cos(PI\/float(Type)), scospin=sqrt(0.75-cospin*cospin);\n\t nc=vec3(-0.5,-cospin,scospin);\n}\nvec3 fold(vec3 pos) {\n\t for(int i=0;i<Type;i++){\n\t\tpos=abs(pos);\n\t\tpos-=2.*min(0.,dot(pos,nc))*nc;\n\t }\n\t return pos;\n}\n\n\/\/vec2 rotate(vec2 v, float angle) {return cos(angle)*v+sin(angle)*vec2(v.y,-v.x);}\nvec3 fractal(vec3 p, vec2 c){\n\tvec2 s=sin(c);c=cos(c);\n\tmat2 rm1=mat2(c.x,s.x,-s.x,c.x),rm2=mat2(c.y,s.y,-s.y,c.y);\n\tfor(int i=0;i<5;i++){\n\t\tp.xy=p.xy*rm1;\n\t\tp.xz=p.xz*rm2;\n\t\tp=abs(p)*2.0+vec3(-0.04,-0.12,-1.5);\n\t}\n\treturn p*0.03125;\n}\n\nfloat DE(in vec3 p){\n\tfloat dF=p.y+1.5;\n\tvec2 c=floor(p.xz*0.333333);\n\tc=fract(sin(c)*31.567)*vec2(1.57,-0.25);\n\tp.xz=mod(p.xz,3.0)-1.5;\n\tp=fold(p);\n\tp=fractal(p,c);\n\treturn min(dF,length(max(abs(p)-vec3(1.0,0.001,0.001),0.0)));\n}\n\nvec4 mcol;\nfloat CE(in vec3 p){\n\tfloat d=DE(p);\n\tif(p.y>-1.45){\n\t\tvec2 c=floor(p.xz*0.333333)+p.xy*0.5;\n\t\tmcol+=vec4(vec3(cos(c.y)*sin(c.x),sin(c.y),cos(c.y)*cos(c.x))*0.33+0.66,0.2);\n\t}else mcol+=vec4(0.3,0.4,1.0,0.3);\n\treturn d;\n}\n\nfloat ShadAO(in vec3 ro, in vec3 rd){\n\tfloat t=0.0,s=1.0,d,mn=0.01+0.04*rnd;\n\tfor(int i=0;i<8;i++){\n\t\td=max(DE(ro+rd*t)*1.5,mn);\n\t\ts=min(s,d\/t+t*0.5);\n\t\tt+=d;\n\t}\n\treturn s;\n}\nvec3 LightDir(in vec3 ro){\n\tfloat tim=iGlobalTime*0.1;\n\tvec3 LD=vec3(cos(tim),1.0,sin(tim))*0.707;\n\treturn LD;\n\t\/\/return normalize(LP-ro);\n}\nvec3 Backdrop(in vec3 rd){\n\tvec3 L=LightDir(rd);\n\tvec3 col=vec3(0.3,0.4,0.5)+rd*0.1+vec3(1.0,0.8,0.6)*(max(0.0,dot(rd,L))*0.2+pow(max(0.0,dot(rd,L)),40.0));\n\tcol*=sqrt(0.5*(rd.y+1.0));\n\treturn col;\n}\n\nvec3 scene(in vec3 ro, in vec3 rd){\n\tfloat d=DE(ro)*rnd*0.15,t=d,od=1.0,pxl=1.6\/iResolution.y;\n\tvec4 dm=vec4(1000.0),tm=vec4(-1.0);\n\tfor(int i=0;i<78;i++){\n\t\td=DE(ro+rd*t);\n\t\tif(d<pxl*t && d<od && tm.w<0.0){dm=vec4(d,dm.xyz);tm=vec4(t,tm.xyz);}\n\t\tt+=min(d,0.1+t*t*0.04);\n\t\tod=d;\n\t\tif(t>20.0 || d<0.00001)break;\n\t}\n\tif(d<pxl*t && d<dm.x){dm.x=d;tm.x=t;}\n\tvec3 col=Backdrop(rd),fcol=col;\n\tfor(int i=0;i<4;i++){\n\t\tif(tm.x<0.0)break;\n\t\tfloat px=pxl*tm.x;\n\t\tvec3 so=ro+rd*tm.x;\n\t\tmcol=vec4(0.0);\n\t\tvec3 ve=vec3(px,0.0,0.0);\n\t\tfloat d1=CE(so);\n\t\tvec3 dn=vec3(CE(so-ve.xyy),CE(so-ve.yxy),CE(so-ve.yyx));\n\t\tvec3 dp=vec3(CE(so+ve.xyy),CE(so+ve.yxy),CE(so+ve.yyx));\n\t\tvec3 N=(dp-dn)\/(length(dp-vec3(d1))+length(vec3(d1)-dn));\n\t\tvec3 L=LightDir(so);\n\t\tvec3 scol=mcol.rgb*0.14;\n\t\tvec3 R=reflect(rd,N);\n\t\tfloat v=dot(-rd,N),l=dot(N,L);\n\t\tfloat shad=ShadAO(so+N*0.001,L);\n\t\tvec3 cc=vec3(0.6,0.8,1.0),lc=vec3(1.0,0.8,0.6);\n\t\tfloat cd=exp(-distance(ro,so));\n\t\tfloat spcl=pow(clamp(dot(R,L),0.0,1.0),10.0),spcc=pow(max(0.0,dot(R,-rd)),1.0+cd)*0.25;\n\t\tscol=scol*(cd*v*cc+shad*l*lc)+(cd*spcc*cc+shad*spcl*lc)*mcol.a;\n\t\tscol=clamp(scol,0.0,1.0);\n\t\tfloat fog=min(pow(tm.x,0.4)*0.3,1.0);\n\t\tscol=mix(scol,fcol,fog);\n\t\tcol=mix(scol,col,clamp(dm.x\/px,0.0,1.0));\n\t\tdm=dm.yzwx;tm=tm.yzwx;\n\t}\n\tif(col!=col)col=vec3(1.0,0.0,0.0);\n\treturn clamp(col*2.0,0.0,1.0);\n}\nmat3 lookat(vec3 fw){\n\tfw=normalize(fw);vec3 rt=normalize(cross(fw,vec3(0.0,1.0,0.0)));return mat3(rt,cross(rt,fw),fw);\n}\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord){\n\tInit();\n\trandomize(fragCoord);\n\tvec3 rd=normalize(vec3((2.0*fragCoord-iResolution.xy)\/iResolution.y,1.0));\n\tfloat tim=iGlobalTime;\n\tvec3 ro=vec3(tim-1.5,1.2,tim);\n\trd=lookat(vec3(1.0+sin(tim+sin(tim)),-0.5+sin(tim*0.3)*0.3,1.0))*rd;\n\t\/\/ro=eye;rd=normalize(dir);\n\tfragColor=vec4(scene(ro,rd),1.0);\n}\n","name":"","description":"","type":"image"},{"inputs":[],"outputs":[{"channel":"0"}],"code":"#define bps 8.0\nfloat nofs(float n){\/\/the song's \"random\" ring\n    n=mod(n,8.0);\n    if(n<1.0)return -5.0;\n    if(n<2.0)return -5.0;\n    if(n<3.0)return -5.0;\n    if(n<4.0)return 0.0;\n    if(n<5.0)return -1.0;\n    if(n<6.0)return 0.0;\n    if(n<7.0)return 0.0;\n    return 12.0;\n}\n\nfloat scale(float note){\/\/throws out dissonant tones\n\tfloat n2=mod(note,12.0);\n\tif((n2==1.0)||(n2==3.0)||(n2==6.0)||(n2==8.0)||(n2==10.0))note=-100.0;\/\/major\n\t\/\/if((n2==1.0)||(n2==4.0)||(n2==6.0)||(n2==9.0)||(n2==11.0))note=-100.0;\/\/minor\n\t\/\/if((n2==1.0)||(n2==4.0)||(n2==5.0)||(n2==9.0)||(n2==10.0))note=-100.0;\/\/hungarian minor\n\tif(note>96.0)note=96.0+n2;\n\treturn note;\n}\nfloat ntof(float note){\/\/note frequencies from wikipedia\n\tif(note<12.0)return 0.0;\n\tfloat octave=floor((note+0.5)\/12.0)-5.0;\n\tnote=mod(note,12.0);\n\tfloat nt=493.88;\/\/b\n    \tif(note<0.5)nt=261.63;\/\/c\n\telse if(note<1.5)nt=277.18;\/\/c#\n\telse if(note<2.5)nt=293.66;\/\/d\n    \telse if(note<3.5)nt=311.13;\/\/d#\n    \telse if(note<4.5)nt=329.63;\/\/e\n    \telse if(note<5.5)nt=349.23;\/\/f\n    \telse if(note<6.5)nt=369.99;\/\/f#\n    \telse if(note<7.5)nt=392.0;\/\/g\n    \telse if(note<8.5)nt=415.30;\/\/g#\n    \telse if(note<9.5)nt=440.0;\/\/a\n    \telse if(note<10.5)nt=466.16;\/\/a#\n\treturn nt*pow(2.0,octave);\n}\n\n\/\/ note number to frequency  from https:\/\/www.shadertoy.com\/view\/ldfSW2\n\/\/float ntof(float n){return (n>0.0)?440.0 * pow(2.0, (n - 67.0) \/ 12.0):0.0;}\n\n#define PI 3.1416\n\nfloat I(float f, float t, float amp, float freq, float wpwr, float apwr, float att){\n\tfloat a=sin(f*PI+amp*PI*sin(f*PI*freq));\n\tif(t<att)t=1.0-t*(1.0-att)\/att;\n\treturn sign(a)*pow(abs(a),wpwr)*(1.0-pow(t,apwr));\n}\nvec2 inst(float n,float t,float bt,float pan,int i){\n\tfloat f=ntof(scale(n));\n\tif(f<12.0)return vec2(0.0);\t\n\tfloat a=I(f*t,bt*0.5,0.0,0.0,2.0+float(i*i)*2.0,0.5,0.1);\n\ta*=60.0\/n;\n\treturn vec2(a*(1.0-pan),a*pan);\n}\nvec2 inst2(float nn,float no,float of,float t,float bt,float pan,int i){\n\treturn inst(nn+of,t,bt,pan,i)+inst(no+of,t,bt+1.0,pan,i);\/\/plays new note and tail of last note\n}\n\nvec2 mainSound(float time)\n{\n\tfloat tim=time*bps;\n\tfloat b=floor(tim);\n\tfloat t0=fract(tim),t1=mod(tim,2.0)*0.5,t2=mod(tim,4.0)*0.25;\n\tfloat n2=nofs(b*0.0625)+nofs(b*0.125)+nofs(b*0.25);\n\tfloat n1=n2+nofs(b*0.5),n0=n1+nofs(b);\n\tb-=1.0;\/\/go back in time to finish old notes\n\tfloat n5=nofs(b*0.0625)+nofs(b*0.125)+nofs(b*0.25);\n\tfloat n4=n5+nofs(b*0.5),n3=n4+nofs(b);\n\tb-=1.0;\n\tn5=nofs(b*0.0625)+nofs(b*0.125)+nofs(b*0.25);\n\tn4=n5+nofs(b*0.5);\n\tb-=2.0;\n\tn5=nofs(b*0.0625)+nofs(b*0.125)+nofs(b*0.25);\n\tvec2 a0=inst2(n0,n3,72.0,time,t0,0.8,0);\n\tvec2 a1=inst2(n1,n4,60.0,time,t1,0.5,1);\n\tvec2 a2=inst2(n2,n5,48.0,time,t2,0.2,2);\n\t\/\/vec2 a1h=inst2(n1,n4,57.0,time,t1,0.6,0);\n\t\/\/vec2 a2h=vec2(0.0);\/\/inst2(n2,n5,53.0,time,t2,0.25,0);\n\t\/\/vec2 a1hb=inst(n1+64.0,time,t1,0.0,1)*2.0;\n\tvec2 v=0.25*(a0+a1+a2);\n\treturn clamp(v,-1.0,1.0);\n}\n","name":"","description":"","type":"sound"}]}}