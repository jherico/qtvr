{"Shader":{"ver":"0.1","info":{"id":"lddGDj","date":"1452361945","viewed":218,"name":"Shader Piano","username":"NinjaKoala","description":"Shader Piano<br\/>My original plan was to make it functional with GPU sound, but i then realized it wasn't possible because i don't have access to the Render buffers in the sound shader <img src=\"\/img\/emoticonSad.png\"\/>","likes":0,"published":3,"flags":32,"tags":["2d","piano"],"hasliked":0},"renderpass":[{"inputs":[{"id":257,"src":"\/presets\/previz\/buffer00.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"outputs":[{"channel":"0"}],"code":"float border=2.\/iResolution.x;\n\nvoid black_key_render(vec4 color1, vec4 color2, vec2 uv, float pos, float pitch_offset, float curr_pitch, inout vec4 color){\n\n\tfloat mod_x=mod(uv.x+4.*59.\/725.,413.\/725.);\n\tfloat div_x=floor((uv.x+4.*59.\/725.)\/(413.\/725.));\n\n\tvec4 col;\n\tif(curr_pitch == pitch_offset+div_x*12.){\n\t\tcol=color1;\n\t}\n\telse{\n\t\tcol=color2;\n\t}\n\tcolor=mix(color,col,smoothstep(-border,0.,5.\/29.-abs(uv.y-.25+5.\/29.))*smoothstep(-border,0.,127.\/5800.-abs(mod_x-pos\/5800.)));\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ){\n\tvec2 uv=fragCoord.xy\/iResolution.xy;\n\tuv-=.5;\n    uv.y*=iResolution.y\/iResolution.x;\n\n\tvec4 black=vec4(0,0,0,1);\n\tvec4 white=vec4(1,1,1,1);\n\tvec4 grey=vec4(.5,.5,.5,1);\n\tvec4 green=vec4(0,1,0,1);\n\tvec4 color=white;\n\n\t\/\/white key location:\n\tfloat key_loc = floor(725.\/59.*(uv.x+531.\/1450.));\n    \n\n\t\/\/key_loc=-46.; \/\/bad location ;) triggers weird bug\n\t\/\/float pitch=-79.; \/\/corresponding pitch\n\n\t\/\/white key pitch:\n\tfloat pitch=float((2*int(key_loc) - int(floor((float(key_loc)+.5)\/3.5))));\n\n\t\/\/float mouse_pitch=floor(mod(iGlobalTime*1.,22.))-3.;\n    float mouse_pitch = texture2D(iChannel0,vec2(0)).r;\n\n\tif(mouse_pitch==pitch){\n\t\tcolor=green;\n\t}\n\t\n\t\/\/white key horizontal border\n\tcolor=mix(black,color,smoothstep(0.,border,abs(mod(uv.x,59.\/725.)-59.\/1450.)));\n\t\n\t\/\/black keys\n\t\n\tblack_key_render(green, black, uv, 183., 1., mouse_pitch, color);\n\tblack_key_render(green, black, uv, 743., 3., mouse_pitch, color);\n\tblack_key_render(green, black, uv, 1577., 6., mouse_pitch, color);\n\tblack_key_render(green, black, uv, 2115., 8., mouse_pitch, color);\n\tblack_key_render(green, black, uv, 2653., 10., mouse_pitch, color);\n\t\n\n\t\/\/vertical border\n\tcolor=mix(white,color,step(0.,.25 - abs(uv.y)));\n\tcolor=mix(black,color,smoothstep(0.,border,abs(.25-abs(uv.y))));\n\n\tfragColor=color;\n}\n","name":"","description":"","type":"image"},{"inputs":[{"id":257,"src":"\/presets\/previz\/buffer00.png","ctype":"buffer","channel":0,"sampler":{"filter":"linear","wrap":"clamp","vflip":"true","srgb":"false","internal":"byte"}}],"outputs":[{"channel":"0"}],"code":"void black_key_pitch(vec2 uv, float pos, float pitch_offset, inout float pitch){\n\tif(5.\/29.-abs(uv.y-.25+5.\/29.)>0. && 127.\/5800.-abs(mod(uv.x+4.*59.\/725.,413.\/725.)-pos\/5800.) > 0.){\n\t\tfloat div_x=floor((uv.x+4.*59.\/725.)\/(413.\/725.));\n\t\tpitch=pitch_offset+div_x*12.;\n\t}\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 mouse=iMouse.xy\/iResolution.xy;\n\tmouse-=.5;\n    mouse.y*=iResolution.y\/iResolution.x;\n    \n    fragColor=vec4(0);\n    fragColor.r=texture2D(iChannel0,vec2(0)).r;\n    \n    float mouse_loc=floor(725.\/59.*(mouse.x+531.\/1450.));\n    \n    if(.25 - abs(mouse.y)>.0){\n\t\tfragColor.r=2.*mouse_loc - floor((mouse_loc+.5)\/3.5);\n    }\n\n\tblack_key_pitch(mouse, 183., 1., fragColor.r);\n\tblack_key_pitch(mouse, 743., 3., fragColor.r);\n\tblack_key_pitch(mouse, 1577., 6., fragColor.r);\n\tblack_key_pitch(mouse, 2115., 8., fragColor.r);\n\tblack_key_pitch(mouse, 2653., 10., fragColor.r);\n}","name":"","description":"","type":"buffer"}]}}